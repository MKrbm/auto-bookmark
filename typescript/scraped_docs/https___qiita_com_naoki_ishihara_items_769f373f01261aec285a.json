[
  {
    "page_content": "re:Invent 2023でGAされたAgents for Amazon BedrockとAmazon Kendraを組み合わせてRAGを構築\n検証\nsearchsearchSearchLoginSignupsearch\nsearchsearchSearchLoginSignupsearchTrendQiita Engineer Festa 2024QuestionOfficial EventOfficial ColumnsignpostCareerOrganization\n      {\"isHideGlobalNavigation\":false}\n      \n\n      {\"isShowTfaDownloadAlert\":null}\n      \n{\"@context\":\"http://schema.org\",\"@type\":\"BreadcrumbList\",\"itemListElement\":[{\"@type\":\"ListItem\",\"position\":1,\"item\":{\"@id\":\"/\",\"name\":\"Qiita\"}},{\"@type\":\"ListItem\",\"position\":2,\"item\":{\"@id\":\"/tags/aws\",\"name\":\"AWS\"}}]}{\"@context\":\"http://schema.org\",\"@type\":\"Article\",\"datePublished\":\"2023-12-16T15:52:16.000+09:00\",\"dateModified\":\"2023-12-20T13:00:21.000+09:00\",\"headline\":\"re:Invent 2023でGAされたAgents for Amazon BedrockとAmazon Kendraを組み合わせてRAGを構築\",\"image\":\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Fadvent-calendar-ogp-background-7940cd1c8db80a7ec40711d90f43539e.jpg?ixlib=rb-4.0.0\\u0026w=1200\\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTk3MiZoPTM3OCZ0eHQ9cmUlM0FJbnZlbnQlMjAyMDIzJUUzJTgxJUE3R0ElRTMlODElOTUlRTMlODIlOEMlRTMlODElOUZBZ2VudHMlMjBmb3IlMjBBbWF6b24lMjBCZWRyb2NrJUUzJTgxJUE4QW1hem9uJTIwS2VuZHJhJUUzJTgyJTkyJUU3JUI1JTg0JUUzJTgxJUJGJUU1JTkwJTg4JUUzJTgyJThGJUUzJTgxJTlCJUUzJTgxJUE2UkFHJUUzJTgyJTkyJUU2JUE3JThCJUU3JUFGJTg5JnR4dC1hbGlnbj1sZWZ0JTJDdG9wJnR4dC1jb2xvcj0lMjMzQTNDM0MmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTYmcz01ZjA0NzlkNWJhYTFiZWY5OTU0NzdkM2JjODE4MGUwMg\\u0026mark-x=120\\u0026mark-y=96\\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZoPTc2Jnc9OTcyJnR4dD0lNDBOYW9raV9Jc2hpaGFyYSZ0eHQtY29sb3I9JTIzM0EzQzNDJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTM2JnR4dC1hbGlnbj1sZWZ0JTJDdG9wJnM9Mjc5MTBiZTJhYTM3YzZkYzQ4NjRkNTEwNzRiZjgzNmM\\u0026blend-x=120\\u0026blend-y=445\\u0026blend-mode=normal\\u0026txt64=aW4g5qCq5byP5Lya56S-44K744K-44Oz44OG44Kv44OO44Ot44K444O8\\u0026txt-width=972\\u0026txt-clip=end%2Cellipsis\\u0026txt-color=%233A3C3C\\u0026txt-font=Hiragino%20Sans%20W6\\u0026txt-size=36\\u0026txt-x=134\\u0026txt-y=546\\u0026s=aad9750f4e3cf36d1c085be07f687004\",\"mainEntityOfPage\":\"https://qiita.com/Naoki_Ishihara/items/769f373f01261aec285a\",\"author\":{\"@type\":\"Person\",\"address\":\"\",\"email\":null,\"identifier\":\"Naoki_Ishihara\",\"name\":\"Naoki_Ishihara\",\"image\":\"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fs3-ap-northeast-1.amazonaws.com%2Fqiita-image-store%2F0%2F2988434%2F7a415bfcdc60c99e01ba67e689b48ab72e4fb235%2Flarge.png%3F1696181594?ixlib=rb-4.0.0\\u0026auto=compress%2Cformat\\u0026lossless=0\\u0026w=75\\u0026s=c9bac246cf67a4e7b8df462e549841d4\",\"url\":\"https://qiita.com/Naoki_Ishihara\",\"description\":\"2024 Japan AWS Top Engineers (ML) / AWS Community Builder (ML ＆ Gen AI) / 2023 Japan AWS Jr. Champions\\r\\n\\r\\n記事に関する質問はXのDMまで！\",\"memberOf\":[{\"@type\":\"Organization\",\"address\":\"東京都港区赤坂1-8-1　赤坂インターシティAIR 19F\",\"legalName\":\"株式会社セゾンテクノロジー\",\"image\":\"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/ffcdf7271e842dfd0c71262a62752c722f1dadec/original.jpg?1713328211\",\"logo\":\"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/ff5415de2b8d3f7b68fad91b4f006b78bcf9542c/original.jpg?1711937197\",\"identifier\":\"saison-technology\",\"description\":\"ミッションクリティカルなシステム開発×日本発のグローバルソフトウェアで世界をつなぐセゾンテクノロジー。誰もがデータを活用できる社会を目指して、未来を切り拓くテクノロジーを追求しています。\"}]},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Qiita\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https://cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png\"}}}html {\n  scroll-behavior: smooth;\n}{\"railsEnv\":\"production\",\"inMailer\":false,\"i18nLocale\":\"en\",\"i18nDefaultLocale\":\"en\",\"rorVersion\":\"13.4.0\",\"rorPro\":false,\"href\":\"https://qiita.com/Naoki_Ishihara/items/769f373f01261aec285a\",\"location\":\"/Naoki_Ishihara/items/769f373f01261aec285a\",\"scheme\":\"https\",\"host\":\"qiita.com\",\"port\":null,\"pathname\":\"/Naoki_Ishihara/items/769f373f01261aec285a\",\"search\":null,\"httpAcceptLanguage\":null,\"actionPath\":\"public/items#show\",\"settings\":{\"analyticsTrackingId\":\"G-KEVS5DBRVN\",\"tagManagerId\":\"GTM-W9W5TX4\",\"assetsMap\":{},\"csrfToken\":\"vbW3qkvT1OL8Er727PorMskoFvgSqQQbJp7o5vZeBOSiBXWEW6vwEA5TxKKdFDz4o4QHGYtICsBzDFbpyCaohQ\",\"locale\":\"en\",\"pushOne\":{\"accessToken\":\"4bc4bb057a0601d388a7b9e499ca2307e9eb4fc172804e310c59e511d7cac356\",\"dialogImageUrl\":\"//cdn.qiita.com/assets/public/push_notification/image-qiitan-572179a3bbde375850422ea48b2b6272.png\"},\"textlint\":{\"workerUrl\":\"//cdn.qiita.com/assets/public/textlint-worker-710c3647d9e69349bb56573324d51014.min.js\"}},\"currentUser\":null,\"isLoggedIn\":false,\"isFindyPageReleased\":true,\"isEngineerFesta2024BeingHeld\":true,\"recaptchaSiteKey\":\"6LdDE6gpAAAAANCGOJu9_xiI5Z-txJxHCz8uBP8Y\",\"errorIconPath\":\"//cdn.qiita.com/assets/icons/large/missing-profile-image-828ed5829a93fbb35746a6c0f7c8107e.png\",\"additionalParams\":{\"query_parameters\":{},\"path_parameters\":{\"controller\":\"public/items\",\"action\":\"show\",\"user_id\":\"Naoki_Ishihara\",\"type\":\"items\",\"id\":\"769f373f01261aec285a\"},\"request_id\":\"2256a15f-f828-4913-8c97-9670c23fafd1\",\"user_id\":null},\"realms\":[{\"humanName\":\"Qiita\",\"isCurrentRealm\":true,\"isQiita\":true,\"isQiitaTeam\":false,\"loggedInUser\":null,\"teamId\":null,\"url\":\"https://qiita.com/\"}],\"serverSide\":false}\n24Go to list of users who liked6more_horizparkJapan AWS Jr. ChampionsAdvent Calendar 2023Day 16@Naoki_Ishihara(石原 直樹)in株式会社セゾンテクノロジーre:Invent 2023でGAされたAgents for Amazon BedrockとAmazon Kendraを組み合わせてRAGを構築AWSragbedrockKendraAgentsForAmazonBedrockLast updated at 2023-12-20Posted at 2023-12-16この記事はJapan AWS Jr. Champions Advent Calendar 2023 16日目の記事です！\n\nAgents for Amazon Bedrockとは\nre:Invent 2023よりGAが発表されたAmazon Bedrockの新機能です。\n通常の基盤モデルの場合、質問すると回答してくれるのみのため、実際のタスクはその回答を読んだ人間が行う必要がありました。\nこれに対し、Agents for Amazon Bedrock では、質問に対して何をすべきかを基盤モデル自身が思考し、計画し、実行してくれます。さらに事前に関数を設定することで、質問に対し必要であれば関数を実行する、ということまで自律して行ってくれます。\nLangChain Agentに機能としては似ています。\n\nPhoto by 石原\n\n\n\nまた、Knowldge base for Amazon BedrockもAgents for Amazon Bedrockと同時にGAが発表されたBedrockの新機能です。\nS3にデータを配置し、「Create Knowledge base」を選択するだけで簡単にRAG（Retrieval Argumented Genaration、検索拡張性） を構築することができます。\n情報を参照するためのインデックスとしては、Amazon OpenSearch Serveless, Pinecone, Redis Enterprise Cloud のいずれかから選択が可能です。\nさらにAgents for Amazon Bedrockと統合されており、GUIによる設定のみでエージェントを介したRAGを構築することができます。\n\n\n\n\n\n\n\nAmazon Kendraとは\nAmazon Kendra とはエンタープライズサーチの機能を有したAWSのサービスです。\n昨今Bedrockと組み合わせたRAGの用途ととしても非常に注目されています。\n\n\n\n\nBedrock+KendraによるRAGと、Knowledge baseの違い\nLLMが情報を参照するインデックスが異なるため、コスト、検索能力、データソースの種類などが異なります。\n検索機能に関しては、Amazon Kendraは全文検索とセマンティック検索、Knowledge Base for Amazon Bedrockではベクター検索が用いられます。\nまた、仕様としてKnowledge Baseが参照できるデータソースはS3のみであり、Amazon Kendraは約40種類ものデータソースを提供しております。\nさらに、Amazon Kendraは書き込む際に、コンテンツにメタ情報を付与したり、パスを指定のURLに変更したりと自由にコンテンツをカスタマイズすることが可能です。\nKnowledge baseがインデックスに書き込む情報はテキストとそのテキストのベクトル、そしてS3パスの3つのみです。\n\n\n\n\n\n\n以上のことから、エージェントを介したRAGを構築したい場合にKnowledge baseよりKendraを採用したいケースが存在すると考えられることから、その検証を行った結果をご紹介いたします。\n\n検証\n今回はAgents for Amazon BedrockがKendraから検索して情報を取得して回答するRAGを構築しました。\nその際に、Kendraの機能を使ってコンテンツのパスを指定のURLに変更し、RAGが回答する際に指定したURLも添えてくれる、ということを目指しました。\n\nBedrockが参照するコンテンツの用意\n今回は私が以前書いた記事のHTMLファイルを使用します。\n\n\n\nS3に用意したHTMLファイルと、そのコンテンツをカスタマイズするためのメタデータファイルを用意します。\n\nメタデータファイル\n{\n    \"Attributes\": {\n        \"_source_uri\": \"https://qiita.com/Naoki_Ishihara/items/7bfefc5a4750aa50c58e\"\n    },\n    \"Title\": \"Amazon KendraにおけるWebクローラーコネクタの有用な機能とその設定方法（追記：Amazon Q For Business UseにおけるWebクローラーについて）\",\n    \"ContentType\": \"HTML\"\n}\n\nそして、KendraのS3コネクタを使用して同期します。\n検証としてKendraのインデックスに検索をかけてみると、ちゃんとコンテンツにタイトルが追加されたり、パスが指定のURLに変更されていることが分かります。\n\n\n\n\n\nエージェント作成\nBedrockのナビゲーションペインから「Agenta」→「Create Agent」を選択します。\n\nStep1：エージェントの詳細\nエージェント名以外の設定はデフォルトを設定し、Nextを選択します。\n\n\nStep2：モデル選択\nモデルはClaude v2を選び、\n「Instructions for the Agent」に、システムプロンプトを入力します。\nどのようなプロセスで対応してほしいかをステップバイステップで記述します。\n\nあなたは、Amazon KendraのWebクローラーの設定に関するエキスパートです。質問に対し、以下の手順で対応してください。各ステップは厳格に実施し、指示に従ってください。\n1. 質問に対し、あなたは適切なキーワードを決定し、Amazon KendraのWebクローラーに関するドキュメントに対し検索を行います。検索の実行は、私の指示を仰ぐことなく実行してください。 \n2. 検索結果の出力： 検索を行って情報を取得した場合、ソースURLは必ず私に表示をしてください。これは例外なく守ってください。\t\n\n\nStep3：アクショングループ追加\nアクショングループとしてLambda関数と、その入力と出力を定義するOpneAPI.ymlテンプレートを設定します。\n\n\nLambda関数\nアクショングループでLambdaを呼び出す際のイベントコンテキストは下記ドキュメントで定義されています。\n\n\n\nこちらを利用して、Kendraの検索結果を取得する下記Lambda関数を作成しました\nimport boto3  # boto3ライブラリをインポート\nimport json  # jsonライブラリをインポート\n\nkendra = boto3.client('kendra')  # AWS Kendraサービスのクライアントを生成\n\ndef search(search_keyword):  # 検索キーワードを引数にとる検索関数\n    query_text = search_keyword  # 検索キーワードをクエリテキストとして設定\n    index_id = '<INDEX_ID>'  # KendraのインデックスIDを設定\n\n    # Kendraにクエリを送信し、レスポンスを受け取る\n    response = kendra.retrieve(\n        QueryText=query_text,\n        IndexId=index_id,\n        # 日本語(_language_code = \"ja\")のドキュメントに絞り込むための属性フィルターを設定\n        AttributeFilter={\n            \"AndAllFilters\": [\n                {\n                    \"EqualsTo\": {\n                        \"Key\": \"_language_code\",\n                        \"Value\": {\"StringValue\": \"ja\"}\n                    }\n                },\n            ]\n        }\n    )\n\n    extracted_results = []  # 結果を格納するリストを初期化\n    # response['ResultItems']の最初のアイテムだけを抽出して保存\n    for item in response['ResultItems'][:1]:\n        extracted_results.append({\n            'DocumentTitle': item.get('DocumentTitle'),  # ドキュメントのタイトル\n            'Content': item.get('Content'),  # ドキュメントの内容\n            'DocumentURI': item.get('DocumentURI')  # ドキュメントのURI\n        })\n        \n    # 検索結果を含む辞書を返す\n    return {\n        \"QueryId\": response['QueryId'],  # クエリID\n        \"Results\": extracted_results  # 抽出された検索結果\n    }\n    \ndef lambda_handler(event, context):  # Lambdaのメインハンドラ\n    print(event)  # イベントデータをプリント\n\n    parameters = event.get(\"parameters\", [])  # イベントからパラメータを取得\n    if not parameters:  # パラメータがない場合はエラーメッセージを返す\n        return {\n            \"statusCode\": 400,\n            \"body\": json.dumps({\"message\": \"No parameters provided.\"})\n        }\n\n    # parametersの最初の要素のvalueをsearch_keywordとして使用\n    search_keyword = parameters[0][\"value\"]\n    print(f'Search keyword: {search_keyword}')  # 検索キーワードを出力\n\n    api_path = event.get(\"apiPath\", \"\")  # イベントからAPIパスを取得\n    body = None  # レスポンスボディの初期化\n\n    if api_path == \"/search\":  # APIパスが/searchの場合は検索関数を実行\n        body = search(search_keyword)\n\n    elif api_path == \"/submit\":  # /submitパスはこの例では実装されていない\n        # submitアクションが実装されていないため、エラーメッセージを返す\n        return {\n            \"statusCode\": 400,\n            \"body\": json.dumps({\"message\": \"Submit action not implemented.\"})\n        }\n\n    if body is None:  # APIパスが不正な場合はエラーメッセージを返す\n        return {\n            \"statusCode\": 400,\n            \"body\": json.dumps({\"message\": \"Invalid API path.\"})\n        }\n\n    # レスポンスボディをJSON形式でエンコーディングして返す\n    response_body = {\n        \"application/json\": {\n            \"body\": json.dumps(body, ensure_ascii=False)\n        }\n    }\n\n    # アクションレスポンスを作成\n    action_response = {\n        \"actionGroup\": event.get(\"actionGroup\"),  # アクショングループ\n        \"apiPath\": api_path,  # APIパス\n        \"httpMethod\": event.get(\"httpMethod\"),  # HTTPメソッド\n        \"httpStatusCode\": 200,  # HTTPステータスコード\n        \"responseBody\": response_body,  # レスポンスボディ\n    }\n\n    # APIレスポンスを作成\n    api_response = {\n        \"messageVersion\": \"1.0\",  # メッセージバージョン\n        \"response\": action_response  # アクションレスポンス\n    }\n\n    return api_response  # 最終的なレスポンスを返す\n\nクエリAPIは戻り値がシンプルなretrieve APIを使用しました。\n\n\nKendraのretrieve APIが対応しているboto3のバージョンがデフォルトのpythonランタイムだと対応していなかったので手動でレイヤー追加を行いました。\n\n\n\nOpenAPIスキーマ\nOpenAPIスキーマはこちらを設定しました。\nopenapi: 3.0.0\ninfo:\n  title: 'Test API'\n  description: \"APIs for testing Agents' behavior\"\n  version: '1.0.0'\npaths:\n  /search:\n    get:\n      summary: 'Web Crawler Document in Amazon Kendra'\n      description: |\n        この関数は、Amazon KendraのWebクローラーコネクタに関するドキュメントを検索し、情報を取得するAPIです。検索することで、タイトル、ドキュメントの内容、ドキュメントのURIをJSON形式の配列で必ず返します。\n      operationId: searchFaq\n      parameters:\n        - in: query\n          name: q\n          description: 検索キーワード\n          required: true\n          schema:\n            type: string\n      responses:\n        '200':\n          description: 検索結果を返します。\n          content:\n            application/json:\n              schema:\n                type: object\n                properties:\n                  QueryId:\n                    type: string\n                    description: 検索クエリのID\n                  Results:\n                    type: array\n                    description: 検索結果のリスト\n                    items:\n                      type: object\n                      properties:\n                        DocumentTitle:\n                          type: string\n                          description: ドキュメントのタイトル\n                        Content:\n                          type: string\n                          description: ドキュメントの内容\n                        DocumentURI:\n                          type: string\n                          description: ドキュメントのURI\n\nこのスキーマに基づきエージェントがどの関数を呼び出すか判断を行います。\n\n\n\n\nStep4：ナレッジベースを追加\nKnowledge baseを追加することができますが、今回は必要がないため飛ばします。\n\n以上の設定によりエージェントを作成します。\n\nテスト\nエージェント作成後、右横の画面ですぐにテストすることができます。\n\n質問：KendraのWebクローラーの設定において、クローラ深さはどのように設定すればよいですか？\n\nソースを基に回答をしてくれていることが分かります。\nしかしながら、プロンプトで命令していたソースURLを表示してくれません。\nどのような推論をしているか「Show trace」→「Orchestration and knowledge base」→「Step 2」を選択して中身を覗いてみます。\n\nエージェントは「Kendra web crawler クローラ深さ 設定」というキーワードで検索していることが分かります。\nそしてタイトル、コンテキスト、ドキュメントURIをきちんと渡せていることが分かります。\nStep3を覗いてみます。\n\n生成された最終的な回答ではURIが表示されていません。\nどうやらLLMが取得したURLを表示させることが出来ていないことが分かります。\n\nAdvanced Promptsについて(未検証)\nAgents for Amazon Bedrockでは、エージェンが推論を行うためのプロンプトテンプレートを編集することができ、LLMの動作をより詳細に制御することが可能なAdvanced Promptsという機能が提供されています。\nその設定画面を見ると、エージェントは\nPre-processing → Orchestration → KB response generation → Post-processing　という順番で推論していることが分かります。\nそして、推論毎にプロンプトを編集したり、Lambda関数を設定することが可能なようです。\n\n\n\n\n次回は、これをプロンプトエンジニアリングで編集することで、より命令に忠実にLLMが回答させる検証を行ってみようと思います。\n24Go to list of users who liked6comment0Go to list of commentsRegister as a new user and use Qiita more convenientlyYou get articles that match your needsYou can efficiently read back useful informationYou can use dark themeWhat you can do with signing upSign upLogin24Go to list of users who liked6more_horiz\n      {\"authorAnalyticsTrackingId\":null,\"findyEventPopup\":{\"findyLogoImageUrl\":\"//cdn.qiita.com/assets/public/popup/logo-findy-bb852343bec19c0eb60a1e3c033a4e78.png\",\"promotion\":{\"title\":\"「書類通過率を上げる！？」魅力的な職務経歴書の書き方セミナー開催中\",\"description\":\"Findyセミナーで職務経歴書の役割や書き方、 自身の魅力の棚卸し方法などを限定公開\",\"linkUrl\":\"https://findy-code.io/events/gVnxPn99N2z1x?fr=qiita_event_notification_20240701\\u0026utm_source=qiita\\u0026utm_medium=notification_20240701\",\"startAt\":\"2024-06-19T00:00:00.000+09:00\",\"endAt\":\"2024-06-30T23:59:59.999+09:00\",\"slot\":\"popup\"}},\"laprasLogoImageUrl\":\"//cdn.qiita.com/assets/public/popup/logo-lapras-22f91c2afce964f4be9e8610a3282bbb.png\",\"forkwellLogoImageUrl\":\"//cdn.qiita.com/assets/public/popup/logo-forkwell-9f13ec7d93d1bef99827b20095decc59.svg\",\"techPlayLogoImageUrl\":\"//cdn.qiita.com/assets/public/popup/logo-tech_play-e962097aeab9db19f70b70bf18a2add4.png\",\"organizationAnalyticsTrackingId\":\"G-591RZ936WV\",\"promptLoginMessageImageSrc\":\"//cdn.qiita.com/assets/public/image-qiitan_for_login_modal-014e085d3e40a240e3fe8d61b70b29a9.png\",\"isPostCompletePromptShow\":false,\"postCompleteModalImages\":[],\"findyEventCompletePromptPromotion\":null,\"isDisplayAdAboveArticle\":false,\"adventCalendarBeingHeldImageSrc\":\"//cdn.qiita.com/assets/public/advent_calendar/image-advent_calendar_being_held-bafa166cb2e60037f5e4ba3599642d8f.png\",\"engineerFesta2024LabelImageSrc\":\"//cdn.qiita.com/assets/public/official_campaigns/engineer_festa_2024/back-label_decoration-38495dd16cb6a3347397f4c3e6fefc62.png\"}\n      \nHow developers code is here.© 2011-2024Qiita Inc.Guide & HelpAboutTermsPrivacyGuidelineDesign GuidelineFeedbackHelpAdvertisementContentsRelease NoteOfficial EventOfficial ColumnAdvent CalendarQiita AwardAPICareerSNS@Qiita@qiita_milestone@qiitapoi@QiitaOur serviceQiita TeamQiita ZineOfficial ShopCompanyAbout UsCareersQiita Blog\n      {}\n      \n\n      {\"imageUrl\":\"//cdn.qiita.com/assets/public/image-qiitan_for_login_modal_glimpse-c148ec9e4debf1f4b880deec194b6fc8.png\",\"githubAuthUrl\":\"https://oauth.qiita.com/auth/github?callback_action=login_or_signup\\u0026realm=qiita\\u0026redirect_to=%2FNaoki_Ishihara%2Fitems%2F769f373f01261aec285a\",\"googleAuthUrl\":\"https://oauth.qiita.com/auth/google?callback_action=login_or_signup\\u0026realm=qiita\\u0026redirect_to=%2FNaoki_Ishihara%2Fitems%2F769f373f01261aec285a\",\"twitterAuthUrl\":\"https://oauth.qiita.com/auth/twitter?callback_action=login_or_signup\\u0026realm=qiita\\u0026redirect_to=%2FNaoki_Ishihara%2Fitems%2F769f373f01261aec285a\"}\n      \n{\"snackbar\":{\"type\":\"\",\"body\":\"\",\"isActive\":false},\"adventCalendar\":{\"adventCalendar\":{\"currentDateTime\":\"Sun, 30 Jun 2024 12:57:31 +0900\",\"isAdventCalendarBeingHeld\":false,\"isCalendarCreatable\":false,\"isLatestHeldYear\":true,\"isPreRegistering\":false,\"isRankingBeingHeld\":false,\"isSubscribable\":false,\"year\":2023,\"years\":[2023,2022,2021,2020,2019,2018,2017,2016,2015,2014,2013,2012,2011]}},\"article\":{\"article\":{\"body\":\"\\u003cp data-sourcepos=\\\"1:1-1:141\\\"\\u003eこの記事は\\u003ca href=\\\"https://qiita.com/advent-calendar/2023/jr-champions\\\"\\u003eJapan AWS Jr. Champions Advent Calendar 2023\\u003c/a\\u003e 16日目の記事です！\\u003c/p\\u003e\\n\\u003ch2 data-sourcepos=\\\"3:1-3:34\\\"\\u003e\\n\\u003cspan id=\\\"agents-for-amazon-bedrockとは\\\" class=\\\"fragment\\\"\\u003e\\u003c/span\\u003e\\u003ca href=\\\"#agents-for-amazon-bedrock%E3%81%A8%E3%81%AF\\\"\\u003e\\u003ci class=\\\"fa fa-link\\\"\\u003e\\u003c/i\\u003e\\u003c/a\\u003eAgents for Amazon Bedrockとは\\u003c/h2\\u003e\\n\\u003cp data-sourcepos=\\\"4:1-4:75\\\"\\u003ere:Invent 2023よりGAが発表されたAmazon Bedrockの新機能です。\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"6:1-6:177\\\"\\u003e通常の基盤モデルの場合、質問すると回答してくれるのみのため、実際のタスクはその回答を読んだ人間が行う必要がありました。\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"8:1-8:348\\\"\\u003eこれに対し、\\u003cstrong\\u003eAgents for Amazon Bedrock\\u003c/strong\\u003e では、質問に対して何をすべきかを基盤モデル自身が\\u003cstrong\\u003e思考\\u003c/strong\\u003eし、\\u003cstrong\\u003e計画\\u003c/strong\\u003eし、\\u003cstrong\\u003e実行\\u003c/strong\\u003eしてくれます。さらに事前に関数を設定することで、質問に対し必要であれば関数を実行する、ということまで自律して行ってくれます。\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"10:1-10:129\\\"\\u003e\\u003ca href=\\\"https://zenn.dev/umi_mori/books/prompt-engineer/viewer/langchain_agents\\\" rel=\\\"nofollow noopener\\\" target=\\\"_blank\\\"\\u003eLangChain Agent\\u003c/a\\u003eに機能としては似ています。\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"12:1-13:17\\\"\\u003e\\u003ca href=\\\"https://camo.qiitausercontent.com/1543e2b67d5b91f982275d407dc7fdd5b4941253/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f323938383433342f32313738383338382d353732352d353662632d623764352d3433653935343635663861322e6a706567\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener\\\"\\u003e\\u003cimg src=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2988434%2F21788388-5725-56bc-b7d5-43e95465f8a2.jpeg?ixlib=rb-4.0.0\\u0026amp;auto=format\\u0026amp;gif-q=60\\u0026amp;q=75\\u0026amp;s=69c9655f041f49d9d276558de78133f6\\\" alt=\\\"IMG_9357.jpg\\\" data-canonical-src=\\\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2988434/21788388-5725-56bc-b7d5-43e95465f8a2.jpeg\\\" srcset=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2988434%2F21788388-5725-56bc-b7d5-43e95465f8a2.jpeg?ixlib=rb-4.0.0\\u0026amp;auto=format\\u0026amp;gif-q=60\\u0026amp;q=75\\u0026amp;w=1400\\u0026amp;fit=max\\u0026amp;s=90f9bab1a9863750d47e8485f3467f74 1x\\\" loading=\\\"lazy\\\"\\u003e\\u003c/a\\u003e\\u003cbr\\u003e\\n\\u003cem\\u003ePhoto by 石原\\u003c/em\\u003e\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"15:1-15:70\\\"\\u003e\\u003ciframe id=\\\"qiita-embed-content__6e4261740860270268e5ab9554a3e978\\\" src=\\\"https://qiita.com/embed-contents/link-card#qiita-embed-content__6e4261740860270268e5ab9554a3e978\\\" data-content=\\\"https%3A%2F%2Fdocs.aws.amazon.com%2Fja_jp%2Fbedrock%2Flatest%2Fuserguide%2Fagents.html\\\" frameborder=\\\"0\\\" scrolling=\\\"no\\\" loading=\\\"lazy\\\" style=\\\"width:100%;\\\" height=\\\"29\\\"\\u003e\\n\\u003c/iframe\\u003e\\n\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"17:1-17:133\\\"\\u003eまた、\\u003cstrong\\u003eKnowldge base for Amazon Bedrock\\u003c/strong\\u003eもAgents for Amazon Bedrockと同時にGAが発表されたBedrockの新機能です。\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"19:1-20:170\\\"\\u003eS3にデータを配置し、「Create Knowledge base」を選択するだけで簡単に\\u003cstrong\\u003eRAG（Retrieval Argumented Genaration、検索拡張性）\\u003c/strong\\u003e を構築することができます。\\u003cbr\\u003e\\n情報を参照するためのインデックスとしては、Amazon OpenSearch Serveless, Pinecone, Redis Enterprise Cloud のいずれかから選択が可能です。\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"22:1-22:160\\\"\\u003eさらにAgents for Amazon Bedrockと統合されており、GUIによる設定のみでエージェントを介したRAGを構築することができます。\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"24:1-24:77\\\"\\u003e\\u003ciframe id=\\\"qiita-embed-content__e006b7be3b41486d331110e8bbf8f432\\\" src=\\\"https://qiita.com/embed-contents/link-card#qiita-embed-content__e006b7be3b41486d331110e8bbf8f432\\\" data-content=\\\"https%3A%2F%2Fwww.ibm.com%2Fblogs%2Fsolutions%2Fjp-ja%2Fretrieval-augmented-generation-rag%2F\\\" frameborder=\\\"0\\\" scrolling=\\\"no\\\" loading=\\\"lazy\\\" style=\\\"width:100%;\\\" height=\\\"29\\\"\\u003e\\n\\u003c/iframe\\u003e\\n\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"26:1-26:78\\\"\\u003e\\u003ciframe id=\\\"qiita-embed-content__cf9bfec979443535e3609142a0c3eadd\\\" src=\\\"https://qiita.com/embed-contents/link-card#qiita-embed-content__cf9bfec979443535e3609142a0c3eadd\\\" data-content=\\\"https%3A%2F%2Fdocs.aws.amazon.com%2Fja_jp%2Fbedrock%2Flatest%2Fuserguide%2Fknowledge-base.html\\\" frameborder=\\\"0\\\" scrolling=\\\"no\\\" loading=\\\"lazy\\\" style=\\\"width:100%;\\\" height=\\\"29\\\"\\u003e\\n\\u003c/iframe\\u003e\\n\\u003c/p\\u003e\\n\\u003ch2 data-sourcepos=\\\"28:1-28:22\\\"\\u003e\\n\\u003cspan id=\\\"amazon-kendraとは\\\" class=\\\"fragment\\\"\\u003e\\u003c/span\\u003e\\u003ca href=\\\"#amazon-kendra%E3%81%A8%E3%81%AF\\\"\\u003e\\u003ci class=\\\"fa fa-link\\\"\\u003e\\u003c/i\\u003e\\u003c/a\\u003eAmazon Kendraとは\\u003c/h2\\u003e\\n\\u003cp data-sourcepos=\\\"29:1-30:97\\\"\\u003e\\u003cstrong\\u003eAmazon Kendra\\u003c/strong\\u003e とはエンタープライズサーチの機能を有したAWSのサービスです。\\u003cbr\\u003e\\n昨今Bedrockと組み合わせたRAGの用途ととしても非常に注目されています。\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"32:1-32:33\\\"\\u003e\\u003ciframe id=\\\"qiita-embed-content__97291f47c9cefbad0d1849305819be45\\\" src=\\\"https://qiita.com/embed-contents/link-card#qiita-embed-content__97291f47c9cefbad0d1849305819be45\\\" data-content=\\\"https%3A%2F%2Faws.amazon.com%2Fjp%2Fkendra%2F\\\" frameborder=\\\"0\\\" scrolling=\\\"no\\\" loading=\\\"lazy\\\" style=\\\"width:100%;\\\" height=\\\"29\\\"\\u003e\\n\\u003c/iframe\\u003e\\n\\u003c/p\\u003e\\n\\u003ch2 data-sourcepos=\\\"34:1-34:58\\\"\\u003e\\n\\u003cspan id=\\\"bedrockkendraによるragとknowledge-baseの違い\\\" class=\\\"fragment\\\"\\u003e\\u003c/span\\u003e\\u003ca href=\\\"#bedrockkendra%E3%81%AB%E3%82%88%E3%82%8Brag%E3%81%A8knowledge-base%E3%81%AE%E9%81%95%E3%81%84\\\"\\u003e\\u003ci class=\\\"fa fa-link\\\"\\u003e\\u003c/i\\u003e\\u003c/a\\u003eBedrock+KendraによるRAGと、Knowledge baseの違い\\u003c/h2\\u003e\\n\\u003cp data-sourcepos=\\\"35:1-35:147\\\"\\u003eLLMが情報を参照するインデックスが異なるため、コスト、検索能力、データソースの種類などが異なります。\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"37:1-37:180\\\"\\u003e検索機能に関しては、Amazon Kendraは\\u003cstrong\\u003e全文検索とセマンティック検索\\u003c/strong\\u003e、Knowledge Base for Amazon Bedrockでは\\u003cstrong\\u003eベクター検索\\u003c/strong\\u003eが用いられます。\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"39:1-39:186\\\"\\u003eまた、仕様としてKnowledge Baseが参照できるデータソースは\\u003cstrong\\u003eS3のみ\\u003c/strong\\u003eであり、Amazon Kendraは\\u003cstrong\\u003e約40種類\\u003c/strong\\u003eものデータソースを提供しております。\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"41:1-42:149\\\"\\u003eさらに、Amazon Kendraは書き込む際に、コンテンツに\\u003cstrong\\u003eメタ情報を付与\\u003c/strong\\u003eしたり、パスを指定のURLに\\u003cstrong\\u003e変更\\u003c/strong\\u003eしたりと自由にコンテンツをカスタマイズすることが可能です。\\u003cbr\\u003e\\nKnowledge baseがインデックスに書き込む情報はテキストとそのテキストのベクトル、そしてS3パスの3つのみです。\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"44:1-44:84\\\"\\u003e\\u003ciframe id=\\\"qiita-embed-content__881993b5a49e82b81c2b826b3cc16812\\\" src=\\\"https://qiita.com/embed-contents/link-card#qiita-embed-content__881993b5a49e82b81c2b826b3cc16812\\\" data-content=\\\"https%3A%2F%2Fdocs.aws.amazon.com%2Fja_jp%2Fbedrock%2Flatest%2Fuserguide%2Fknowledge-base-setup.html\\\" frameborder=\\\"0\\\" scrolling=\\\"no\\\" loading=\\\"lazy\\\" style=\\\"width:100%;\\\" height=\\\"29\\\"\\u003e\\n\\u003c/iframe\\u003e\\n\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"46:1-46:71\\\"\\u003e\\u003ciframe id=\\\"qiita-embed-content__ec811f7369cbab247367c57b8201e73e\\\" src=\\\"https://qiita.com/embed-contents/link-card#qiita-embed-content__ec811f7369cbab247367c57b8201e73e\\\" data-content=\\\"https%3A%2F%2Fdocs.aws.amazon.com%2Fja_jp%2Fkendra%2Flatest%2Fdg%2Fhiw-data-source.html\\\" frameborder=\\\"0\\\" scrolling=\\\"no\\\" loading=\\\"lazy\\\" style=\\\"width:100%;\\\" height=\\\"29\\\"\\u003e\\n\\u003c/iframe\\u003e\\n\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"48:1-48:249\\\"\\u003e以上のことから、エージェントを介したRAGを構築したい場合にKnowledge baseより\\u003cstrong\\u003eKendraを採用したい\\u003c/strong\\u003eケースが存在すると考えられることから、その検証を行った結果をご紹介いたします。\\u003c/p\\u003e\\n\\u003ch1 data-sourcepos=\\\"50:1-50:8\\\"\\u003e\\n\\u003cspan id=\\\"検証\\\" class=\\\"fragment\\\"\\u003e\\u003c/span\\u003e\\u003ca href=\\\"#%E6%A4%9C%E8%A8%BC\\\"\\u003e\\u003ci class=\\\"fa fa-link\\\"\\u003e\\u003c/i\\u003e\\u003c/a\\u003e検証\\u003c/h1\\u003e\\n\\u003cp data-sourcepos=\\\"51:1-52:202\\\"\\u003e今回はAgents for Amazon BedrockがKendraから検索して情報を取得して回答するRAGを構築しました。\\u003cbr\\u003e\\nその際に、Kendraの機能を使ってコンテンツのパスを指定のURLに変更し、\\u003cstrong\\u003eRAGが回答する際に指定したURLも添えてくれる\\u003c/strong\\u003e、ということを目指しました。\\u003c/p\\u003e\\n\\u003ch2 data-sourcepos=\\\"54:1-54:49\\\"\\u003e\\n\\u003cspan id=\\\"bedrockが参照するコンテンツの用意\\\" class=\\\"fragment\\\"\\u003e\\u003c/span\\u003e\\u003ca href=\\\"#bedrock%E3%81%8C%E5%8F%82%E7%85%A7%E3%81%99%E3%82%8B%E3%82%B3%E3%83%B3%E3%83%86%E3%83%B3%E3%83%84%E3%81%AE%E7%94%A8%E6%84%8F\\\"\\u003e\\u003ci class=\\\"fa fa-link\\\"\\u003e\\u003c/i\\u003e\\u003c/a\\u003eBedrockが参照するコンテンツの用意\\u003c/h2\\u003e\\n\\u003cp data-sourcepos=\\\"55:1-55:76\\\"\\u003e今回は私が以前書いた記事のHTMLファイルを使用します。\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"57:1-57:59\\\"\\u003e\\u003ciframe id=\\\"qiita-embed-content__6737f74f018d34f40a62162166e61dc6\\\" src=\\\"https://qiita.com/embed-contents/link-card#qiita-embed-content__6737f74f018d34f40a62162166e61dc6\\\" data-content=\\\"https%3A%2F%2Fqiita.com%2FNaoki_Ishihara%2Fitems%2F7bfefc5a4750aa50c58e\\\" frameborder=\\\"0\\\" scrolling=\\\"no\\\" loading=\\\"lazy\\\" style=\\\"width:100%;\\\" height=\\\"29\\\"\\u003e\\n\\u003c/iframe\\u003e\\n\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"59:1-59:144\\\"\\u003eS3に用意したHTMLファイルと、そのコンテンツをカスタマイズするためのメタデータファイルを用意します。\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"61:1-61:122\\\"\\u003e\\u003ca href=\\\"https://camo.qiitausercontent.com/5747da95ad6afbfe6f514bb3547da18cd2cc5a60/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f323938383433342f33353133646161632d393265382d323361662d373131662d6534343230373061313336332e706e67\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener\\\"\\u003e\\u003cimg src=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2988434%2F3513daac-92e8-23af-711f-e442070a1363.png?ixlib=rb-4.0.0\\u0026amp;auto=format\\u0026amp;gif-q=60\\u0026amp;q=75\\u0026amp;s=9fc5461f1f5729ffe1812e1f25465299\\\" alt=\\\"image.png\\\" data-canonical-src=\\\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2988434/3513daac-92e8-23af-711f-e442070a1363.png\\\" srcset=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2988434%2F3513daac-92e8-23af-711f-e442070a1363.png?ixlib=rb-4.0.0\\u0026amp;auto=format\\u0026amp;gif-q=60\\u0026amp;q=75\\u0026amp;w=1400\\u0026amp;fit=max\\u0026amp;s=3c89af29b9b80c01236b0a582937e9bd 1x\\\" loading=\\\"lazy\\\"\\u003e\\u003c/a\\u003e\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"63:1-63:27\\\"\\u003eメタデータファイル\\u003c/p\\u003e\\n\\u003cdiv class=\\\"code-frame\\\" data-lang=\\\"text\\\" data-sourcepos=\\\"64:1-72:3\\\"\\u003e\\u003cdiv class=\\\"highlight\\\"\\u003e\\u003cpre\\u003e\\u003ccode\\u003e{\\n    \\\"Attributes\\\": {\\n        \\\"_source_uri\\\": \\\"https://qiita.com/Naoki_Ishihara/items/7bfefc5a4750aa50c58e\\\"\\n    },\\n    \\\"Title\\\": \\\"Amazon KendraにおけるWebクローラーコネクタの有用な機能とその設定方法（追記：Amazon Q For Business UseにおけるWebクローラーについて）\\\",\\n    \\\"ContentType\\\": \\\"HTML\\\"\\n}\\n\\u003c/code\\u003e\\u003c/pre\\u003e\\u003c/div\\u003e\\u003c/div\\u003e\\n\\u003cp data-sourcepos=\\\"73:1-73:68\\\"\\u003eそして、KendraのS3コネクタを使用して同期します。\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"75:1-75:213\\\"\\u003e検証としてKendraのインデックスに検索をかけてみると、ちゃんとコンテンツにタイトルが追加されたり、パスが指定のURLに変更されていることが分かります。\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"77:1-77:122\\\"\\u003e\\u003ca href=\\\"https://camo.qiitausercontent.com/525d10c875a81ac06b9d618b807ec5d44085a16c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f323938383433342f66346564333437372d386530662d613462372d383466652d6131653731663935643836652e706e67\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener\\\"\\u003e\\u003cimg src=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2988434%2Ff4ed3477-8e0f-a4b7-84fe-a1e71f95d86e.png?ixlib=rb-4.0.0\\u0026amp;auto=format\\u0026amp;gif-q=60\\u0026amp;q=75\\u0026amp;s=d7ecc608868a5c194329028fb66adce7\\\" alt=\\\"image.png\\\" data-canonical-src=\\\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2988434/f4ed3477-8e0f-a4b7-84fe-a1e71f95d86e.png\\\" srcset=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2988434%2Ff4ed3477-8e0f-a4b7-84fe-a1e71f95d86e.png?ixlib=rb-4.0.0\\u0026amp;auto=format\\u0026amp;gif-q=60\\u0026amp;q=75\\u0026amp;w=1400\\u0026amp;fit=max\\u0026amp;s=470f4190ee3092a9f48f4a28374919f2 1x\\\" loading=\\\"lazy\\\"\\u003e\\u003c/a\\u003e\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"79:1-79:67\\\"\\u003e\\u003ciframe id=\\\"qiita-embed-content__611090cd99cd86c1dd1c4b200a43a995\\\" src=\\\"https://qiita.com/embed-contents/link-card#qiita-embed-content__611090cd99cd86c1dd1c4b200a43a995\\\" data-content=\\\"https%3A%2F%2Fdocs.aws.amazon.com%2Fja_jp%2Fkendra%2Flatest%2Fdg%2Fs3-metadata.html\\\" frameborder=\\\"0\\\" scrolling=\\\"no\\\" loading=\\\"lazy\\\" style=\\\"width:100%;\\\" height=\\\"29\\\"\\u003e\\n\\u003c/iframe\\u003e\\n\\u003c/p\\u003e\\n\\u003ch2 data-sourcepos=\\\"81:1-81:27\\\"\\u003e\\n\\u003cspan id=\\\"エージェント作成\\\" class=\\\"fragment\\\"\\u003e\\u003c/span\\u003e\\u003ca href=\\\"#%E3%82%A8%E3%83%BC%E3%82%B8%E3%82%A7%E3%83%B3%E3%83%88%E4%BD%9C%E6%88%90\\\"\\u003e\\u003ci class=\\\"fa fa-link\\\"\\u003e\\u003c/i\\u003e\\u003c/a\\u003eエージェント作成\\u003c/h2\\u003e\\n\\u003cp data-sourcepos=\\\"82:1-82:100\\\"\\u003eBedrockのナビゲーションペインから「Agenta」→「Create Agent」を選択します。\\u003c/p\\u003e\\n\\u003ch3 data-sourcepos=\\\"83:1-83:39\\\"\\u003e\\n\\u003cspan id=\\\"step1エージェントの詳細\\\" class=\\\"fragment\\\"\\u003e\\u003c/span\\u003e\\u003ca href=\\\"#step1%E3%82%A8%E3%83%BC%E3%82%B8%E3%82%A7%E3%83%B3%E3%83%88%E3%81%AE%E8%A9%B3%E7%B4%B0\\\"\\u003e\\u003ci class=\\\"fa fa-link\\\"\\u003e\\u003c/i\\u003e\\u003c/a\\u003eStep1：エージェントの詳細\\u003c/h3\\u003e\\n\\u003cp data-sourcepos=\\\"84:1-85:122\\\"\\u003eエージェント名以外の設定はデフォルトを設定し、Nextを選択します。\\u003cbr\\u003e\\n\\u003ca href=\\\"https://camo.qiitausercontent.com/7d744af198db4b82580698358d70591128391a30/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f323938383433342f35326431333637632d363037652d373532322d363036642d3336653763326239336566392e706e67\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener\\\"\\u003e\\u003cimg src=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2988434%2F52d1367c-607e-7522-606d-36e7c2b93ef9.png?ixlib=rb-4.0.0\\u0026amp;auto=format\\u0026amp;gif-q=60\\u0026amp;q=75\\u0026amp;s=6032f384c0b8659da23bda8845a451c0\\\" alt=\\\"image.png\\\" data-canonical-src=\\\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2988434/52d1367c-607e-7522-606d-36e7c2b93ef9.png\\\" srcset=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2988434%2F52d1367c-607e-7522-606d-36e7c2b93ef9.png?ixlib=rb-4.0.0\\u0026amp;auto=format\\u0026amp;gif-q=60\\u0026amp;q=75\\u0026amp;w=1400\\u0026amp;fit=max\\u0026amp;s=498cc5f4a7daee7eb78dfa80c8f9f577 1x\\\" loading=\\\"lazy\\\"\\u003e\\u003c/a\\u003e\\u003c/p\\u003e\\n\\u003ch3 data-sourcepos=\\\"87:1-87:27\\\"\\u003e\\n\\u003cspan id=\\\"step2モデル選択\\\" class=\\\"fragment\\\"\\u003e\\u003c/span\\u003e\\u003ca href=\\\"#step2%E3%83%A2%E3%83%87%E3%83%AB%E9%81%B8%E6%8A%9E\\\"\\u003e\\u003ci class=\\\"fa fa-link\\\"\\u003e\\u003c/i\\u003e\\u003c/a\\u003eStep2：モデル選択\\u003c/h3\\u003e\\n\\u003cp data-sourcepos=\\\"88:1-90:108\\\"\\u003eモデルはClaude v2を選び、\\u003cbr\\u003e\\n「Instructions for the Agent」に、システムプロンプトを入力します。\\u003cbr\\u003e\\nどのようなプロセスで対応してほしいかをステップバイステップで記述します。\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"92:1-92:122\\\"\\u003e\\u003ca href=\\\"https://camo.qiitausercontent.com/e135bbad12a33fe2bc75e04ff4091641a456c733/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f323938383433342f37313564383534392d396331662d653936322d353639312d3633656366396331373261382e706e67\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener\\\"\\u003e\\u003cimg src=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2988434%2F715d8549-9c1f-e962-5691-63ecf9c172a8.png?ixlib=rb-4.0.0\\u0026amp;auto=format\\u0026amp;gif-q=60\\u0026amp;q=75\\u0026amp;s=5358d4392c2b4cb11c2496a4abe813fd\\\" alt=\\\"image.png\\\" data-canonical-src=\\\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2988434/715d8549-9c1f-e962-5691-63ecf9c172a8.png\\\" srcset=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2988434%2F715d8549-9c1f-e962-5691-63ecf9c172a8.png?ixlib=rb-4.0.0\\u0026amp;auto=format\\u0026amp;gif-q=60\\u0026amp;q=75\\u0026amp;w=1400\\u0026amp;fit=max\\u0026amp;s=21bb80691104147bc238efa35ee34e77 1x\\\" loading=\\\"lazy\\\"\\u003e\\u003c/a\\u003e\\u003c/p\\u003e\\n\\u003cdiv class=\\\"code-frame\\\" data-lang=\\\"text\\\" data-sourcepos=\\\"94:1-98:3\\\"\\u003e\\u003cdiv class=\\\"highlight\\\"\\u003e\\u003cpre\\u003e\\u003ccode\\u003eあなたは、Amazon KendraのWebクローラーの設定に関するエキスパートです。質問に対し、以下の手順で対応してください。各ステップは厳格に実施し、指示に従ってください。\\n1. 質問に対し、あなたは適切なキーワードを決定し、Amazon KendraのWebクローラーに関するドキュメントに対し検索を行います。検索の実行は、私の指示を仰ぐことなく実行してください。 \\n2. 検索結果の出力： 検索を行って情報を取得した場合、ソースURLは必ず私に表示をしてください。これは例外なく守ってください。\\t\\n\\u003c/code\\u003e\\u003c/pre\\u003e\\u003c/div\\u003e\\u003c/div\\u003e\\n\\u003ch3 data-sourcepos=\\\"99:1-99:45\\\"\\u003e\\n\\u003cspan id=\\\"step3アクショングループ追加\\\" class=\\\"fragment\\\"\\u003e\\u003c/span\\u003e\\u003ca href=\\\"#step3%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E8%BF%BD%E5%8A%A0\\\"\\u003e\\u003ci class=\\\"fa fa-link\\\"\\u003e\\u003c/i\\u003e\\u003c/a\\u003eStep3：アクショングループ追加\\u003c/h3\\u003e\\n\\u003cp data-sourcepos=\\\"100:1-101:122\\\"\\u003eアクショングループとしてLambda関数と、その入力と出力を定義するOpneAPI.ymlテンプレートを設定します。\\u003cbr\\u003e\\n\\u003ca href=\\\"https://camo.qiitausercontent.com/00427d4f33286e5dc7f3dcfb79e8a31085a5177d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f323938383433342f32323036643562372d633134632d323134352d363866392d3730356335616461653365622e706e67\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener\\\"\\u003e\\u003cimg src=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2988434%2F2206d5b7-c14c-2145-68f9-705c5adae3eb.png?ixlib=rb-4.0.0\\u0026amp;auto=format\\u0026amp;gif-q=60\\u0026amp;q=75\\u0026amp;s=ae87ff8fad3ec1da8472f6468d9957b6\\\" alt=\\\"image.png\\\" data-canonical-src=\\\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2988434/2206d5b7-c14c-2145-68f9-705c5adae3eb.png\\\" srcset=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2988434%2F2206d5b7-c14c-2145-68f9-705c5adae3eb.png?ixlib=rb-4.0.0\\u0026amp;auto=format\\u0026amp;gif-q=60\\u0026amp;q=75\\u0026amp;w=1400\\u0026amp;fit=max\\u0026amp;s=e0a9fb54fda29111f955bc9e37444316 1x\\\" loading=\\\"lazy\\\"\\u003e\\u003c/a\\u003e\\u003c/p\\u003e\\n\\u003ch4 data-sourcepos=\\\"103:1-103:17\\\"\\u003e\\n\\u003cspan id=\\\"lambda関数\\\" class=\\\"fragment\\\"\\u003e\\u003c/span\\u003e\\u003ca href=\\\"#lambda%E9%96%A2%E6%95%B0\\\"\\u003e\\u003ci class=\\\"fa fa-link\\\"\\u003e\\u003c/i\\u003e\\u003c/a\\u003eLambda関数\\u003c/h4\\u003e\\n\\u003cp data-sourcepos=\\\"105:1-105:144\\\"\\u003eアクショングループでLambdaを呼び出す際のイベントコンテキストは下記ドキュメントで定義されています。\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"107:1-107:71\\\"\\u003e\\u003ciframe id=\\\"qiita-embed-content__7da2553d400f116e7a91efa57962bdfc\\\" src=\\\"https://qiita.com/embed-contents/link-card#qiita-embed-content__7da2553d400f116e7a91efa57962bdfc\\\" data-content=\\\"https%3A%2F%2Fdocs.aws.amazon.com%2Fbedrock%2Flatest%2Fuserguide%2Fagents-lambda.html\\\" frameborder=\\\"0\\\" scrolling=\\\"no\\\" loading=\\\"lazy\\\" style=\\\"width:100%;\\\" height=\\\"29\\\"\\u003e\\n\\u003c/iframe\\u003e\\n\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"109:1-109:102\\\"\\u003eこちらを利用して、Kendraの検索結果を取得する下記Lambda関数を作成しました\\u003c/p\\u003e\\n\\u003cdiv class=\\\"code-frame\\\" data-lang=\\\"python\\\" data-sourcepos=\\\"110:1-208:3\\\"\\u003e\\u003cdiv class=\\\"highlight\\\"\\u003e\\u003cpre\\u003e\\u003ccode\\u003e\\u003cspan class=\\\"kn\\\"\\u003eimport\\u003c/span\\u003e \\u003cspan class=\\\"n\\\"\\u003eboto3\\u003c/span\\u003e  \\u003cspan class=\\\"c1\\\"\\u003e# boto3ライブラリをインポート\\n\\u003c/span\\u003e\\u003cspan class=\\\"kn\\\"\\u003eimport\\u003c/span\\u003e \\u003cspan class=\\\"n\\\"\\u003ejson\\u003c/span\\u003e  \\u003cspan class=\\\"c1\\\"\\u003e# jsonライブラリをインポート\\n\\u003c/span\\u003e\\n\\u003cspan class=\\\"n\\\"\\u003ekendra\\u003c/span\\u003e \\u003cspan class=\\\"o\\\"\\u003e=\\u003c/span\\u003e \\u003cspan class=\\\"n\\\"\\u003eboto3\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\\"nf\\\"\\u003eclient\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e'\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003ekendra\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e'\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e)\\u003c/span\\u003e  \\u003cspan class=\\\"c1\\\"\\u003e# AWS Kendraサービスのクライアントを生成\\n\\u003c/span\\u003e\\n\\u003cspan class=\\\"k\\\"\\u003edef\\u003c/span\\u003e \\u003cspan class=\\\"nf\\\"\\u003esearch\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\\"n\\\"\\u003esearch_keyword\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e):\\u003c/span\\u003e  \\u003cspan class=\\\"c1\\\"\\u003e# 検索キーワードを引数にとる検索関数\\n\\u003c/span\\u003e    \\u003cspan class=\\\"n\\\"\\u003equery_text\\u003c/span\\u003e \\u003cspan class=\\\"o\\\"\\u003e=\\u003c/span\\u003e \\u003cspan class=\\\"n\\\"\\u003esearch_keyword\\u003c/span\\u003e  \\u003cspan class=\\\"c1\\\"\\u003e# 検索キーワードをクエリテキストとして設定\\n\\u003c/span\\u003e    \\u003cspan class=\\\"n\\\"\\u003eindex_id\\u003c/span\\u003e \\u003cspan class=\\\"o\\\"\\u003e=\\u003c/span\\u003e \\u003cspan class=\\\"sh\\\"\\u003e'\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003e\\u0026lt;INDEX_ID\\u0026gt;\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e'\\u003c/span\\u003e  \\u003cspan class=\\\"c1\\\"\\u003e# KendraのインデックスIDを設定\\n\\u003c/span\\u003e\\n    \\u003cspan class=\\\"c1\\\"\\u003e# Kendraにクエリを送信し、レスポンスを受け取る\\n\\u003c/span\\u003e    \\u003cspan class=\\\"n\\\"\\u003eresponse\\u003c/span\\u003e \\u003cspan class=\\\"o\\\"\\u003e=\\u003c/span\\u003e \\u003cspan class=\\\"n\\\"\\u003ekendra\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\\"nf\\\"\\u003eretrieve\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e(\\u003c/span\\u003e\\n        \\u003cspan class=\\\"n\\\"\\u003eQueryText\\u003c/span\\u003e\\u003cspan class=\\\"o\\\"\\u003e=\\u003c/span\\u003e\\u003cspan class=\\\"n\\\"\\u003equery_text\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e,\\u003c/span\\u003e\\n        \\u003cspan class=\\\"n\\\"\\u003eIndexId\\u003c/span\\u003e\\u003cspan class=\\\"o\\\"\\u003e=\\u003c/span\\u003e\\u003cspan class=\\\"n\\\"\\u003eindex_id\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e,\\u003c/span\\u003e\\n        \\u003cspan class=\\\"c1\\\"\\u003e# 日本語(_language_code = \\\"ja\\\")のドキュメントに絞り込むための属性フィルターを設定\\n\\u003c/span\\u003e        \\u003cspan class=\\\"n\\\"\\u003eAttributeFilter\\u003c/span\\u003e\\u003cspan class=\\\"o\\\"\\u003e=\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e{\\u003c/span\\u003e\\n            \\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eAndAllFilters\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"p\\\"\\u003e[\\u003c/span\\u003e\\n                \\u003cspan class=\\\"p\\\"\\u003e{\\u003c/span\\u003e\\n                    \\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eEqualsTo\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"p\\\"\\u003e{\\u003c/span\\u003e\\n                        \\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eKey\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003e_language_code\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e,\\u003c/span\\u003e\\n                        \\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eValue\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"p\\\"\\u003e{\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eStringValue\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eja\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e}\\u003c/span\\u003e\\n                    \\u003cspan class=\\\"p\\\"\\u003e}\\u003c/span\\u003e\\n                \\u003cspan class=\\\"p\\\"\\u003e},\\u003c/span\\u003e\\n            \\u003cspan class=\\\"p\\\"\\u003e]\\u003c/span\\u003e\\n        \\u003cspan class=\\\"p\\\"\\u003e}\\u003c/span\\u003e\\n    \\u003cspan class=\\\"p\\\"\\u003e)\\u003c/span\\u003e\\n\\n    \\u003cspan class=\\\"n\\\"\\u003eextracted_results\\u003c/span\\u003e \\u003cspan class=\\\"o\\\"\\u003e=\\u003c/span\\u003e \\u003cspan class=\\\"p\\\"\\u003e[]\\u003c/span\\u003e  \\u003cspan class=\\\"c1\\\"\\u003e# 結果を格納するリストを初期化\\n\\u003c/span\\u003e    \\u003cspan class=\\\"c1\\\"\\u003e# response['ResultItems']の最初のアイテムだけを抽出して保存\\n\\u003c/span\\u003e    \\u003cspan class=\\\"k\\\"\\u003efor\\u003c/span\\u003e \\u003cspan class=\\\"n\\\"\\u003eitem\\u003c/span\\u003e \\u003cspan class=\\\"ow\\\"\\u003ein\\u003c/span\\u003e \\u003cspan class=\\\"n\\\"\\u003eresponse\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e[\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e'\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eResultItems\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e'\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e][:\\u003c/span\\u003e\\u003cspan class=\\\"mi\\\"\\u003e1\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e]:\\u003c/span\\u003e\\n        \\u003cspan class=\\\"n\\\"\\u003eextracted_results\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\\"nf\\\"\\u003eappend\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e({\\u003c/span\\u003e\\n            \\u003cspan class=\\\"sh\\\"\\u003e'\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eDocumentTitle\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e'\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"n\\\"\\u003eitem\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\\"nf\\\"\\u003eget\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e'\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eDocumentTitle\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e'\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e),\\u003c/span\\u003e  \\u003cspan class=\\\"c1\\\"\\u003e# ドキュメントのタイトル\\n\\u003c/span\\u003e            \\u003cspan class=\\\"sh\\\"\\u003e'\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eContent\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e'\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"n\\\"\\u003eitem\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\\"nf\\\"\\u003eget\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e'\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eContent\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e'\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e),\\u003c/span\\u003e  \\u003cspan class=\\\"c1\\\"\\u003e# ドキュメントの内容\\n\\u003c/span\\u003e            \\u003cspan class=\\\"sh\\\"\\u003e'\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eDocumentURI\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e'\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"n\\\"\\u003eitem\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\\"nf\\\"\\u003eget\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e'\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eDocumentURI\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e'\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e)\\u003c/span\\u003e  \\u003cspan class=\\\"c1\\\"\\u003e# ドキュメントのURI\\n\\u003c/span\\u003e        \\u003cspan class=\\\"p\\\"\\u003e})\\u003c/span\\u003e\\n        \\n    \\u003cspan class=\\\"c1\\\"\\u003e# 検索結果を含む辞書を返す\\n\\u003c/span\\u003e    \\u003cspan class=\\\"k\\\"\\u003ereturn\\u003c/span\\u003e \\u003cspan class=\\\"p\\\"\\u003e{\\u003c/span\\u003e\\n        \\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eQueryId\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"n\\\"\\u003eresponse\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e[\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e'\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eQueryId\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e'\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e],\\u003c/span\\u003e  \\u003cspan class=\\\"c1\\\"\\u003e# クエリID\\n\\u003c/span\\u003e        \\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eResults\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"n\\\"\\u003eextracted_results\\u003c/span\\u003e  \\u003cspan class=\\\"c1\\\"\\u003e# 抽出された検索結果\\n\\u003c/span\\u003e    \\u003cspan class=\\\"p\\\"\\u003e}\\u003c/span\\u003e\\n    \\n\\u003cspan class=\\\"k\\\"\\u003edef\\u003c/span\\u003e \\u003cspan class=\\\"nf\\\"\\u003elambda_handler\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\\"n\\\"\\u003eevent\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e,\\u003c/span\\u003e \\u003cspan class=\\\"n\\\"\\u003econtext\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e):\\u003c/span\\u003e  \\u003cspan class=\\\"c1\\\"\\u003e# Lambdaのメインハンドラ\\n\\u003c/span\\u003e    \\u003cspan class=\\\"nf\\\"\\u003eprint\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\\"n\\\"\\u003eevent\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e)\\u003c/span\\u003e  \\u003cspan class=\\\"c1\\\"\\u003e# イベントデータをプリント\\n\\u003c/span\\u003e\\n    \\u003cspan class=\\\"n\\\"\\u003eparameters\\u003c/span\\u003e \\u003cspan class=\\\"o\\\"\\u003e=\\u003c/span\\u003e \\u003cspan class=\\\"n\\\"\\u003eevent\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\\"nf\\\"\\u003eget\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eparameters\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e,\\u003c/span\\u003e \\u003cspan class=\\\"p\\\"\\u003e[])\\u003c/span\\u003e  \\u003cspan class=\\\"c1\\\"\\u003e# イベントからパラメータを取得\\n\\u003c/span\\u003e    \\u003cspan class=\\\"k\\\"\\u003eif\\u003c/span\\u003e \\u003cspan class=\\\"ow\\\"\\u003enot\\u003c/span\\u003e \\u003cspan class=\\\"n\\\"\\u003eparameters\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e  \\u003cspan class=\\\"c1\\\"\\u003e# パラメータがない場合はエラーメッセージを返す\\n\\u003c/span\\u003e        \\u003cspan class=\\\"k\\\"\\u003ereturn\\u003c/span\\u003e \\u003cspan class=\\\"p\\\"\\u003e{\\u003c/span\\u003e\\n            \\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003estatusCode\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"mi\\\"\\u003e400\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e,\\u003c/span\\u003e\\n            \\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003ebody\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"n\\\"\\u003ejson\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\\"nf\\\"\\u003edumps\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e({\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003emessage\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eNo parameters provided.\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e})\\u003c/span\\u003e\\n        \\u003cspan class=\\\"p\\\"\\u003e}\\u003c/span\\u003e\\n\\n    \\u003cspan class=\\\"c1\\\"\\u003e# parametersの最初の要素のvalueをsearch_keywordとして使用\\n\\u003c/span\\u003e    \\u003cspan class=\\\"n\\\"\\u003esearch_keyword\\u003c/span\\u003e \\u003cspan class=\\\"o\\\"\\u003e=\\u003c/span\\u003e \\u003cspan class=\\\"n\\\"\\u003eparameters\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e[\\u003c/span\\u003e\\u003cspan class=\\\"mi\\\"\\u003e0\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e][\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003evalue\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e]\\u003c/span\\u003e\\n    \\u003cspan class=\\\"nf\\\"\\u003eprint\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\\"sa\\\"\\u003ef\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e'\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eSearch keyword: \\u003c/span\\u003e\\u003cspan class=\\\"si\\\"\\u003e{\\u003c/span\\u003e\\u003cspan class=\\\"n\\\"\\u003esearch_keyword\\u003c/span\\u003e\\u003cspan class=\\\"si\\\"\\u003e}\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e'\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e)\\u003c/span\\u003e  \\u003cspan class=\\\"c1\\\"\\u003e# 検索キーワードを出力\\n\\u003c/span\\u003e\\n    \\u003cspan class=\\\"n\\\"\\u003eapi_path\\u003c/span\\u003e \\u003cspan class=\\\"o\\\"\\u003e=\\u003c/span\\u003e \\u003cspan class=\\\"n\\\"\\u003eevent\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\\"nf\\\"\\u003eget\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eapiPath\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e,\\u003c/span\\u003e \\u003cspan class=\\\"sh\\\"\\u003e\\\"\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e)\\u003c/span\\u003e  \\u003cspan class=\\\"c1\\\"\\u003e# イベントからAPIパスを取得\\n\\u003c/span\\u003e    \\u003cspan class=\\\"n\\\"\\u003ebody\\u003c/span\\u003e \\u003cspan class=\\\"o\\\"\\u003e=\\u003c/span\\u003e \\u003cspan class=\\\"bp\\\"\\u003eNone\\u003c/span\\u003e  \\u003cspan class=\\\"c1\\\"\\u003e# レスポンスボディの初期化\\n\\u003c/span\\u003e\\n    \\u003cspan class=\\\"k\\\"\\u003eif\\u003c/span\\u003e \\u003cspan class=\\\"n\\\"\\u003eapi_path\\u003c/span\\u003e \\u003cspan class=\\\"o\\\"\\u003e==\\u003c/span\\u003e \\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003e/search\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e  \\u003cspan class=\\\"c1\\\"\\u003e# APIパスが/searchの場合は検索関数を実行\\n\\u003c/span\\u003e        \\u003cspan class=\\\"n\\\"\\u003ebody\\u003c/span\\u003e \\u003cspan class=\\\"o\\\"\\u003e=\\u003c/span\\u003e \\u003cspan class=\\\"nf\\\"\\u003esearch\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\\"n\\\"\\u003esearch_keyword\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e)\\u003c/span\\u003e\\n\\n    \\u003cspan class=\\\"k\\\"\\u003eelif\\u003c/span\\u003e \\u003cspan class=\\\"n\\\"\\u003eapi_path\\u003c/span\\u003e \\u003cspan class=\\\"o\\\"\\u003e==\\u003c/span\\u003e \\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003e/submit\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e  \\u003cspan class=\\\"c1\\\"\\u003e# /submitパスはこの例では実装されていない\\n\\u003c/span\\u003e        \\u003cspan class=\\\"c1\\\"\\u003e# submitアクションが実装されていないため、エラーメッセージを返す\\n\\u003c/span\\u003e        \\u003cspan class=\\\"k\\\"\\u003ereturn\\u003c/span\\u003e \\u003cspan class=\\\"p\\\"\\u003e{\\u003c/span\\u003e\\n            \\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003estatusCode\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"mi\\\"\\u003e400\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e,\\u003c/span\\u003e\\n            \\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003ebody\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"n\\\"\\u003ejson\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\\"nf\\\"\\u003edumps\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e({\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003emessage\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eSubmit action not implemented.\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e})\\u003c/span\\u003e\\n        \\u003cspan class=\\\"p\\\"\\u003e}\\u003c/span\\u003e\\n\\n    \\u003cspan class=\\\"k\\\"\\u003eif\\u003c/span\\u003e \\u003cspan class=\\\"n\\\"\\u003ebody\\u003c/span\\u003e \\u003cspan class=\\\"ow\\\"\\u003eis\\u003c/span\\u003e \\u003cspan class=\\\"bp\\\"\\u003eNone\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e  \\u003cspan class=\\\"c1\\\"\\u003e# APIパスが不正な場合はエラーメッセージを返す\\n\\u003c/span\\u003e        \\u003cspan class=\\\"k\\\"\\u003ereturn\\u003c/span\\u003e \\u003cspan class=\\\"p\\\"\\u003e{\\u003c/span\\u003e\\n            \\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003estatusCode\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"mi\\\"\\u003e400\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e,\\u003c/span\\u003e\\n            \\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003ebody\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"n\\\"\\u003ejson\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\\"nf\\\"\\u003edumps\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e({\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003emessage\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eInvalid API path.\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e})\\u003c/span\\u003e\\n        \\u003cspan class=\\\"p\\\"\\u003e}\\u003c/span\\u003e\\n\\n    \\u003cspan class=\\\"c1\\\"\\u003e# レスポンスボディをJSON形式でエンコーディングして返す\\n\\u003c/span\\u003e    \\u003cspan class=\\\"n\\\"\\u003eresponse_body\\u003c/span\\u003e \\u003cspan class=\\\"o\\\"\\u003e=\\u003c/span\\u003e \\u003cspan class=\\\"p\\\"\\u003e{\\u003c/span\\u003e\\n        \\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eapplication/json\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"p\\\"\\u003e{\\u003c/span\\u003e\\n            \\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003ebody\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"n\\\"\\u003ejson\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\\"nf\\\"\\u003edumps\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\\"n\\\"\\u003ebody\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e,\\u003c/span\\u003e \\u003cspan class=\\\"n\\\"\\u003eensure_ascii\\u003c/span\\u003e\\u003cspan class=\\\"o\\\"\\u003e=\\u003c/span\\u003e\\u003cspan class=\\\"bp\\\"\\u003eFalse\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e)\\u003c/span\\u003e\\n        \\u003cspan class=\\\"p\\\"\\u003e}\\u003c/span\\u003e\\n    \\u003cspan class=\\\"p\\\"\\u003e}\\u003c/span\\u003e\\n\\n    \\u003cspan class=\\\"c1\\\"\\u003e# アクションレスポンスを作成\\n\\u003c/span\\u003e    \\u003cspan class=\\\"n\\\"\\u003eaction_response\\u003c/span\\u003e \\u003cspan class=\\\"o\\\"\\u003e=\\u003c/span\\u003e \\u003cspan class=\\\"p\\\"\\u003e{\\u003c/span\\u003e\\n        \\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eactionGroup\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"n\\\"\\u003eevent\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\\"nf\\\"\\u003eget\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eactionGroup\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e),\\u003c/span\\u003e  \\u003cspan class=\\\"c1\\\"\\u003e# アクショングループ\\n\\u003c/span\\u003e        \\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eapiPath\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"n\\\"\\u003eapi_path\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e,\\u003c/span\\u003e  \\u003cspan class=\\\"c1\\\"\\u003e# APIパス\\n\\u003c/span\\u003e        \\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003ehttpMethod\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"n\\\"\\u003eevent\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\\"nf\\\"\\u003eget\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003ehttpMethod\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e),\\u003c/span\\u003e  \\u003cspan class=\\\"c1\\\"\\u003e# HTTPメソッド\\n\\u003c/span\\u003e        \\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003ehttpStatusCode\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"mi\\\"\\u003e200\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e,\\u003c/span\\u003e  \\u003cspan class=\\\"c1\\\"\\u003e# HTTPステータスコード\\n\\u003c/span\\u003e        \\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eresponseBody\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"n\\\"\\u003eresponse_body\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e,\\u003c/span\\u003e  \\u003cspan class=\\\"c1\\\"\\u003e# レスポンスボディ\\n\\u003c/span\\u003e    \\u003cspan class=\\\"p\\\"\\u003e}\\u003c/span\\u003e\\n\\n    \\u003cspan class=\\\"c1\\\"\\u003e# APIレスポンスを作成\\n\\u003c/span\\u003e    \\u003cspan class=\\\"n\\\"\\u003eapi_response\\u003c/span\\u003e \\u003cspan class=\\\"o\\\"\\u003e=\\u003c/span\\u003e \\u003cspan class=\\\"p\\\"\\u003e{\\u003c/span\\u003e\\n        \\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003emessageVersion\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003e1.0\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e,\\u003c/span\\u003e  \\u003cspan class=\\\"c1\\\"\\u003e# メッセージバージョン\\n\\u003c/span\\u003e        \\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eresponse\\u003c/span\\u003e\\u003cspan class=\\\"sh\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"p\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"n\\\"\\u003eaction_response\\u003c/span\\u003e  \\u003cspan class=\\\"c1\\\"\\u003e# アクションレスポンス\\n\\u003c/span\\u003e    \\u003cspan class=\\\"p\\\"\\u003e}\\u003c/span\\u003e\\n\\n    \\u003cspan class=\\\"k\\\"\\u003ereturn\\u003c/span\\u003e \\u003cspan class=\\\"n\\\"\\u003eapi_response\\u003c/span\\u003e  \\u003cspan class=\\\"c1\\\"\\u003e# 最終的なレスポンスを返す\\n\\u003c/span\\u003e\\u003c/code\\u003e\\u003c/pre\\u003e\\u003c/div\\u003e\\u003c/div\\u003e\\n\\u003cp data-sourcepos=\\\"209:1-209:78\\\"\\u003eクエリAPIは戻り値がシンプルなretrieve APIを使用しました。\\u003c/p\\u003e\\n\\u003cdiv data-sourcepos=\\\"211:1-213:3\\\" class=\\\"note warn\\\"\\u003e\\n\\u003cspan class=\\\"fa fa-fw fa-exclamation-circle\\\"\\u003e\\u003c/span\\u003e\\u003cdiv\\u003e\\n\\u003cp data-sourcepos=\\\"212:1-212:194\\\"\\u003eKendraのretrieve APIが対応しているboto3のバージョンがデフォルトのpythonランタイムだと対応していなかったので手動でレイヤー追加を行いました。\\u003c/p\\u003e\\n\\u003c/div\\u003e\\n\\u003c/div\\u003e\\n\\u003ch4 data-sourcepos=\\\"215:1-215:24\\\"\\u003e\\n\\u003cspan id=\\\"openapiスキーマ\\\" class=\\\"fragment\\\"\\u003e\\u003c/span\\u003e\\u003ca href=\\\"#openapi%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E\\\"\\u003e\\u003ci class=\\\"fa fa-link\\\"\\u003e\\u003c/i\\u003e\\u003c/a\\u003eOpenAPIスキーマ\\u003c/h4\\u003e\\n\\u003cp data-sourcepos=\\\"216:1-216:55\\\"\\u003eOpenAPIスキーマはこちらを設定しました。\\u003c/p\\u003e\\n\\u003cdiv class=\\\"code-frame\\\" data-lang=\\\"yml\\\" data-sourcepos=\\\"217:1-263:3\\\"\\u003e\\u003cdiv class=\\\"highlight\\\"\\u003e\\u003cpre\\u003e\\u003ccode\\u003e\\u003cspan class=\\\"na\\\"\\u003eopenapi\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"s\\\"\\u003e3.0.0\\u003c/span\\u003e\\n\\u003cspan class=\\\"na\\\"\\u003einfo\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e\\n  \\u003cspan class=\\\"na\\\"\\u003etitle\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"s1\\\"\\u003e'\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eTest\\u003c/span\\u003e\\u003cspan class=\\\"nv\\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eAPI'\\u003c/span\\u003e\\n  \\u003cspan class=\\\"na\\\"\\u003edescription\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"s2\\\"\\u003e\\\"\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eAPIs\\u003c/span\\u003e\\u003cspan class=\\\"nv\\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003efor\\u003c/span\\u003e\\u003cspan class=\\\"nv\\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003etesting\\u003c/span\\u003e\\u003cspan class=\\\"nv\\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eAgents'\\u003c/span\\u003e\\u003cspan class=\\\"nv\\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003ebehavior\\\"\\u003c/span\\u003e\\n  \\u003cspan class=\\\"na\\\"\\u003eversion\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"s1\\\"\\u003e'\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003e1.0.0'\\u003c/span\\u003e\\n\\u003cspan class=\\\"na\\\"\\u003epaths\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e\\n  \\u003cspan class=\\\"na\\\"\\u003e/search\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e\\n    \\u003cspan class=\\\"na\\\"\\u003eget\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e\\n      \\u003cspan class=\\\"na\\\"\\u003esummary\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"s1\\\"\\u003e'\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eWeb\\u003c/span\\u003e\\u003cspan class=\\\"nv\\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eCrawler\\u003c/span\\u003e\\u003cspan class=\\\"nv\\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eDocument\\u003c/span\\u003e\\u003cspan class=\\\"nv\\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003ein\\u003c/span\\u003e\\u003cspan class=\\\"nv\\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eAmazon\\u003c/span\\u003e\\u003cspan class=\\\"nv\\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003eKendra'\\u003c/span\\u003e\\n      \\u003cspan class=\\\"na\\\"\\u003edescription\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"pi\\\"\\u003e|\\u003c/span\\u003e\\n        \\u003cspan class=\\\"s\\\"\\u003eこの関数は、Amazon KendraのWebクローラーコネクタに関するドキュメントを検索し、情報を取得するAPIです。検索することで、タイトル、ドキュメントの内容、ドキュメントのURIをJSON形式の配列で必ず返します。\\u003c/span\\u003e\\n      \\u003cspan class=\\\"na\\\"\\u003eoperationId\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"s\\\"\\u003esearchFaq\\u003c/span\\u003e\\n      \\u003cspan class=\\\"na\\\"\\u003eparameters\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e\\n        \\u003cspan class=\\\"pi\\\"\\u003e-\\u003c/span\\u003e \\u003cspan class=\\\"na\\\"\\u003ein\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"s\\\"\\u003equery\\u003c/span\\u003e\\n          \\u003cspan class=\\\"na\\\"\\u003ename\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"s\\\"\\u003eq\\u003c/span\\u003e\\n          \\u003cspan class=\\\"na\\\"\\u003edescription\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"s\\\"\\u003e検索キーワード\\u003c/span\\u003e\\n          \\u003cspan class=\\\"na\\\"\\u003erequired\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"kc\\\"\\u003etrue\\u003c/span\\u003e\\n          \\u003cspan class=\\\"na\\\"\\u003eschema\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e\\n            \\u003cspan class=\\\"na\\\"\\u003etype\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"s\\\"\\u003estring\\u003c/span\\u003e\\n      \\u003cspan class=\\\"na\\\"\\u003eresponses\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e\\n        \\u003cspan class=\\\"s1\\\"\\u003e'\\u003c/span\\u003e\\u003cspan class=\\\"s\\\"\\u003e200'\\u003c/span\\u003e\\u003cspan class=\\\"err\\\"\\u003e:\\u003c/span\\u003e\\n          \\u003cspan class=\\\"na\\\"\\u003edescription\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"s\\\"\\u003e検索結果を返します。\\u003c/span\\u003e\\n          \\u003cspan class=\\\"na\\\"\\u003econtent\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e\\n            \\u003cspan class=\\\"na\\\"\\u003eapplication/json\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e\\n              \\u003cspan class=\\\"na\\\"\\u003eschema\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e\\n                \\u003cspan class=\\\"na\\\"\\u003etype\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"s\\\"\\u003eobject\\u003c/span\\u003e\\n                \\u003cspan class=\\\"na\\\"\\u003eproperties\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e\\n                  \\u003cspan class=\\\"na\\\"\\u003eQueryId\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e\\n                    \\u003cspan class=\\\"na\\\"\\u003etype\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"s\\\"\\u003estring\\u003c/span\\u003e\\n                    \\u003cspan class=\\\"na\\\"\\u003edescription\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"s\\\"\\u003e検索クエリのID\\u003c/span\\u003e\\n                  \\u003cspan class=\\\"na\\\"\\u003eResults\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e\\n                    \\u003cspan class=\\\"na\\\"\\u003etype\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"s\\\"\\u003earray\\u003c/span\\u003e\\n                    \\u003cspan class=\\\"na\\\"\\u003edescription\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"s\\\"\\u003e検索結果のリスト\\u003c/span\\u003e\\n                    \\u003cspan class=\\\"na\\\"\\u003eitems\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e\\n                      \\u003cspan class=\\\"na\\\"\\u003etype\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"s\\\"\\u003eobject\\u003c/span\\u003e\\n                      \\u003cspan class=\\\"na\\\"\\u003eproperties\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e\\n                        \\u003cspan class=\\\"na\\\"\\u003eDocumentTitle\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e\\n                          \\u003cspan class=\\\"na\\\"\\u003etype\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"s\\\"\\u003estring\\u003c/span\\u003e\\n                          \\u003cspan class=\\\"na\\\"\\u003edescription\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"s\\\"\\u003eドキュメントのタイトル\\u003c/span\\u003e\\n                        \\u003cspan class=\\\"na\\\"\\u003eContent\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e\\n                          \\u003cspan class=\\\"na\\\"\\u003etype\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"s\\\"\\u003estring\\u003c/span\\u003e\\n                          \\u003cspan class=\\\"na\\\"\\u003edescription\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"s\\\"\\u003eドキュメントの内容\\u003c/span\\u003e\\n                        \\u003cspan class=\\\"na\\\"\\u003eDocumentURI\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e\\n                          \\u003cspan class=\\\"na\\\"\\u003etype\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"s\\\"\\u003estring\\u003c/span\\u003e\\n                          \\u003cspan class=\\\"na\\\"\\u003edescription\\u003c/span\\u003e\\u003cspan class=\\\"pi\\\"\\u003e:\\u003c/span\\u003e \\u003cspan class=\\\"s\\\"\\u003eドキュメントのURI\\u003c/span\\u003e\\n\\u003c/code\\u003e\\u003c/pre\\u003e\\u003c/div\\u003e\\u003c/div\\u003e\\n\\u003cp data-sourcepos=\\\"264:1-264:105\\\"\\u003eこのスキーマに基づきエージェントがどの関数を呼び出すか判断を行います。\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"266:1-266:75\\\"\\u003e\\u003ciframe id=\\\"qiita-embed-content__47c2d0b268a350fca6923ea41539edf7\\\" src=\\\"https://qiita.com/embed-contents/link-card#qiita-embed-content__47c2d0b268a350fca6923ea41539edf7\\\" data-content=\\\"https%3A%2F%2Fdocs.aws.amazon.com%2Fbedrock%2Flatest%2Fuserguide%2Fagents-api-schema.html\\\" frameborder=\\\"0\\\" scrolling=\\\"no\\\" loading=\\\"lazy\\\" style=\\\"width:100%;\\\" height=\\\"29\\\"\\u003e\\n\\u003c/iframe\\u003e\\n\\u003c/p\\u003e\\n\\u003ch3 data-sourcepos=\\\"268:1-268:42\\\"\\u003e\\n\\u003cspan id=\\\"step4ナレッジベースを追加\\\" class=\\\"fragment\\\"\\u003e\\u003c/span\\u003e\\u003ca href=\\\"#step4%E3%83%8A%E3%83%AC%E3%83%83%E3%82%B8%E3%83%99%E3%83%BC%E3%82%B9%E3%82%92%E8%BF%BD%E5%8A%A0\\\"\\u003e\\u003ci class=\\\"fa fa-link\\\"\\u003e\\u003c/i\\u003e\\u003c/a\\u003eStep4：ナレッジベースを追加\\u003c/h3\\u003e\\n\\u003cp data-sourcepos=\\\"269:1-271:63\\\"\\u003eKnowledge baseを追加することができますが、今回は必要がないため飛ばします。\\u003cbr\\u003e\\n\\u003ca href=\\\"https://camo.qiitausercontent.com/98e796c7007050856bd2c99970bd0909e1ae03a5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f323938383433342f34663961313639642d353265662d376136332d653765622d6238393331393930386133382e706e67\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener\\\"\\u003e\\u003cimg src=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2988434%2F4f9a169d-52ef-7a63-e7eb-b89319908a38.png?ixlib=rb-4.0.0\\u0026amp;auto=format\\u0026amp;gif-q=60\\u0026amp;q=75\\u0026amp;s=493a2e21290007badd4473934995097f\\\" alt=\\\"image.png\\\" data-canonical-src=\\\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2988434/4f9a169d-52ef-7a63-e7eb-b89319908a38.png\\\" srcset=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2988434%2F4f9a169d-52ef-7a63-e7eb-b89319908a38.png?ixlib=rb-4.0.0\\u0026amp;auto=format\\u0026amp;gif-q=60\\u0026amp;q=75\\u0026amp;w=1400\\u0026amp;fit=max\\u0026amp;s=20d140d9d9072c6dc33011dd6126a350 1x\\\" loading=\\\"lazy\\\"\\u003e\\u003c/a\\u003e\\u003cbr\\u003e\\n以上の設定によりエージェントを作成します。\\u003c/p\\u003e\\n\\u003ch2 data-sourcepos=\\\"273:1-273:12\\\"\\u003e\\n\\u003cspan id=\\\"テスト\\\" class=\\\"fragment\\\"\\u003e\\u003c/span\\u003e\\u003ca href=\\\"#%E3%83%86%E3%82%B9%E3%83%88\\\"\\u003e\\u003ci class=\\\"fa fa-link\\\"\\u003e\\u003c/i\\u003e\\u003c/a\\u003eテスト\\u003c/h2\\u003e\\n\\u003cp data-sourcepos=\\\"274:1-274:96\\\"\\u003eエージェント作成後、右横の画面ですぐにテストすることができます。\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"276:1-276:122\\\"\\u003e\\u003ca href=\\\"https://camo.qiitausercontent.com/d221f5bc0a4ed397cedd954dcb4411cedba58234/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f323938383433342f64323939633264332d393864302d386566632d316263302d6165303066333539646362662e706e67\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener\\\"\\u003e\\u003cimg src=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2988434%2Fd299c2d3-98d0-8efc-1bc0-ae00f359dcbf.png?ixlib=rb-4.0.0\\u0026amp;auto=format\\u0026amp;gif-q=60\\u0026amp;q=75\\u0026amp;s=d6e8fb2f92379705170c6b19d8aeb869\\\" alt=\\\"image.png\\\" data-canonical-src=\\\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2988434/d299c2d3-98d0-8efc-1bc0-ae00f359dcbf.png\\\" srcset=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2988434%2Fd299c2d3-98d0-8efc-1bc0-ae00f359dcbf.png?ixlib=rb-4.0.0\\u0026amp;auto=format\\u0026amp;gif-q=60\\u0026amp;q=75\\u0026amp;w=1400\\u0026amp;fit=max\\u0026amp;s=5be3a52722307ad44c72f9c00e179c0b 1x\\\" loading=\\\"lazy\\\"\\u003e\\u003c/a\\u003e\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"278:1-279:122\\\"\\u003e質問：KendraのWebクローラーの設定において、クローラ深さはどのように設定すればよいですか？\\u003cbr\\u003e\\n\\u003ca href=\\\"https://camo.qiitausercontent.com/340a559082736579b6c66fe60f748a9ad2e7ebf8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f323938383433342f31306330336638662d643233662d363234362d663435322d3739396632353836613631632e706e67\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener\\\"\\u003e\\u003cimg src=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2988434%2F10c03f8f-d23f-6246-f452-799f2586a61c.png?ixlib=rb-4.0.0\\u0026amp;auto=format\\u0026amp;gif-q=60\\u0026amp;q=75\\u0026amp;s=3783987089094972378c8e7009656fd1\\\" alt=\\\"image.png\\\" data-canonical-src=\\\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2988434/10c03f8f-d23f-6246-f452-799f2586a61c.png\\\" srcset=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2988434%2F10c03f8f-d23f-6246-f452-799f2586a61c.png?ixlib=rb-4.0.0\\u0026amp;auto=format\\u0026amp;gif-q=60\\u0026amp;q=75\\u0026amp;w=1400\\u0026amp;fit=max\\u0026amp;s=a612505967df1f574425bc3d0577c399 1x\\\" loading=\\\"lazy\\\"\\u003e\\u003c/a\\u003e\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"281:1-282:102\\\"\\u003eソースを基に回答をしてくれていることが分かります。\\u003cbr\\u003e\\nしかしながら、プロンプトで命令していたソースURLを表示してくれません。\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"284:1-285:122\\\"\\u003eどのような推論をしているか「Show trace」→「Orchestration and knowledge base」→「Step 2」を選択して中身を覗いてみます。\\u003cbr\\u003e\\n\\u003ca href=\\\"https://camo.qiitausercontent.com/e309f7108512dc6d47b5abf9bcd980c7c340ab7b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f323938383433342f61626666373035662d656663332d663963612d333937632d6465613362346336343435662e706e67\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener\\\"\\u003e\\u003cimg src=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2988434%2Fabff705f-efc3-f9ca-397c-dea3b4c6445f.png?ixlib=rb-4.0.0\\u0026amp;auto=format\\u0026amp;gif-q=60\\u0026amp;q=75\\u0026amp;s=171bb28edb267f8760e62effb93c4f82\\\" alt=\\\"image.png\\\" data-canonical-src=\\\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2988434/abff705f-efc3-f9ca-397c-dea3b4c6445f.png\\\" srcset=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2988434%2Fabff705f-efc3-f9ca-397c-dea3b4c6445f.png?ixlib=rb-4.0.0\\u0026amp;auto=format\\u0026amp;gif-q=60\\u0026amp;q=75\\u0026amp;w=1400\\u0026amp;fit=max\\u0026amp;s=b722feb3b81ae6efa371e956129956d5 1x\\\" loading=\\\"lazy\\\"\\u003e\\u003c/a\\u003e\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"287:1-288:123\\\"\\u003eエージェントは「Kendra web crawler クローラ深さ 設定」というキーワードで検索していることが分かります。\\u003cbr\\u003e\\nそしてタイトル、コンテキスト、ドキュメントURIをきちんと渡せていることが分かります。\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"290:1-291:122\\\"\\u003eStep3を覗いてみます。\\u003cbr\\u003e\\n\\u003ca href=\\\"https://camo.qiitausercontent.com/bd485a1dee2771b203b14f04ce4a71a2c5ea6c2a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f323938383433342f36313362356134342d613631632d386433322d386434362d6563633562663131643339392e706e67\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener\\\"\\u003e\\u003cimg src=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2988434%2F613b5a44-a61c-8d32-8d46-ecc5bf11d399.png?ixlib=rb-4.0.0\\u0026amp;auto=format\\u0026amp;gif-q=60\\u0026amp;q=75\\u0026amp;s=67fd44b298a924b6436c5f3b889ea671\\\" alt=\\\"image.png\\\" data-canonical-src=\\\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2988434/613b5a44-a61c-8d32-8d46-ecc5bf11d399.png\\\" srcset=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2988434%2F613b5a44-a61c-8d32-8d46-ecc5bf11d399.png?ixlib=rb-4.0.0\\u0026amp;auto=format\\u0026amp;gif-q=60\\u0026amp;q=75\\u0026amp;w=1400\\u0026amp;fit=max\\u0026amp;s=be3954601afbc7f80eb66a138da8a24d 1x\\\" loading=\\\"lazy\\\"\\u003e\\u003c/a\\u003e\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"293:1-293:75\\\"\\u003e生成された最終的な回答ではURIが表示されていません。\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"295:1-295:105\\\"\\u003eどうやらLLMが取得したURLを表示させることが出来ていないことが分かります。\\u003c/p\\u003e\\n\\u003ch2 data-sourcepos=\\\"297:1-297:42\\\"\\u003e\\n\\u003cspan id=\\\"advanced-promptsについて未検証\\\" class=\\\"fragment\\\"\\u003e\\u003c/span\\u003e\\u003ca href=\\\"#advanced-prompts%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E6%9C%AA%E6%A4%9C%E8%A8%BC\\\"\\u003e\\u003ci class=\\\"fa fa-link\\\"\\u003e\\u003c/i\\u003e\\u003c/a\\u003eAdvanced Promptsについて(未検証)\\u003c/h2\\u003e\\n\\u003cp data-sourcepos=\\\"299:1-299:267\\\"\\u003eAgents for Amazon Bedrockでは、エージェンが推論を行うためのプロンプトテンプレートを編集することができ、LLMの動作をより詳細に制御することが可能な\\u003cstrong\\u003eAdvanced Prompts\\u003c/strong\\u003eという機能が提供されています。\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"301:1-302:145\\\"\\u003eその設定画面を見ると、エージェントは\\u003cbr\\u003e\\nPre-processing → Orchestration → KB response generation → Post-processing　という順番で推論していることが分かります。\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"304:1-304:120\\\"\\u003eそして、推論毎にプロンプトを編集したり、Lambda関数を設定することが可能なようです。\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"306:1-306:122\\\"\\u003e\\u003ca href=\\\"https://camo.qiitausercontent.com/fc36ec7c2f35f12ace379e87e9429aa675932fc8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f323938383433342f35656535313061362d353363392d393237302d326264322d3131373138653431656336342e706e67\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener\\\"\\u003e\\u003cimg src=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2988434%2F5ee510a6-53c9-9270-2bd2-11718e41ec64.png?ixlib=rb-4.0.0\\u0026amp;auto=format\\u0026amp;gif-q=60\\u0026amp;q=75\\u0026amp;s=2100b2dfe4b6de59c9f47f4620b2580f\\\" alt=\\\"image.png\\\" data-canonical-src=\\\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2988434/5ee510a6-53c9-9270-2bd2-11718e41ec64.png\\\" srcset=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2988434%2F5ee510a6-53c9-9270-2bd2-11718e41ec64.png?ixlib=rb-4.0.0\\u0026amp;auto=format\\u0026amp;gif-q=60\\u0026amp;q=75\\u0026amp;w=1400\\u0026amp;fit=max\\u0026amp;s=28984191543d5b215185fa2c81a730fb 1x\\\" loading=\\\"lazy\\\"\\u003e\\u003c/a\\u003e\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"308:1-308:80\\\"\\u003e\\u003ciframe id=\\\"qiita-embed-content__111b24e59e95611751b78576fdf63c56\\\" src=\\\"https://qiita.com/embed-contents/link-card#qiita-embed-content__111b24e59e95611751b78576fdf63c56\\\" data-content=\\\"https%3A%2F%2Fdocs.aws.amazon.com%2Fja_jp%2Fbedrock%2Flatest%2Fuserguide%2Fadvanced-prompts.html\\\" frameborder=\\\"0\\\" scrolling=\\\"no\\\" loading=\\\"lazy\\\" style=\\\"width:100%;\\\" height=\\\"29\\\"\\u003e\\n\\u003c/iframe\\u003e\\n\\u003c/p\\u003e\\n\\u003cp data-sourcepos=\\\"310:1-310:177\\\"\\u003e次回は、これをプロンプトエンジニアリングで編集することで、より命令に忠実にLLMが回答させる検証を行ってみようと思います。\\u003c/p\\u003e\\n\",\"comments\":{\"totalCount\":0},\"createdAt\":\"2023-12-16T06:52:16Z\",\"elapsedYearsFromLastModifiedAt\":0,\"encryptedId\":\"BAhJIhRBcnRpY2xlLTE3OTg2NTUGOgZFVA==--414435ccc5472fe5a539d0524d9a1db6c9c3fa9db66370a65b2d674488a980a2\",\"isBanned\":false,\"isDeprecated\":false,\"isDestroyableByViewer\":false,\"isEditRequestReadableByViewer\":true,\"isEditRequestSendableByViewer\":true,\"isLikableByViewer\":true,\"isLikedByViewer\":false,\"isPublic\":true,\"isSlide\":false,\"isStockableByViewer\":true,\"isStockedByViewer\":false,\"isSubscribableByViewer\":false,\"isSubscribedByViewer\":false,\"isUpdatableByViewer\":false,\"isUpdated\":true,\"lastModifiedAt\":\"2023-12-20T04:00:21Z\",\"publishedAt\":\"2023-12-16T07:17:38Z\",\"likesCount\":24,\"linkUrl\":\"https://qiita.com/Naoki_Ishihara/items/769f373f01261aec285a\",\"organization\":{\"encryptedId\":\"BAhJIhVPcmdhbml6YXRpb24tNjg1BjoGRVQ=--ed7ee12c0a125a760745105e953df7ceb8f127c01be32d276b077e2634409fa6\",\"isFollowedByViewer\":false,\"name\":\"株式会社セゾンテクノロジー\",\"urlName\":\"saison-technology\",\"logoUrl\":\"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/ff5415de2b8d3f7b68fad91b4f006b78bcf9542c/original.jpg?1711937197\"},\"stockedCount\":6,\"title\":\"re:Invent 2023でGAされたAgents for Amazon BedrockとAmazon Kendraを組み合わせてRAGを構築\",\"toc\":\"\\u003cul\\u003e\\n\\u003cli\\u003e\\n\\u003ca href=\\\"#agents-for-amazon-bedrock%E3%81%A8%E3%81%AF\\\"\\u003eAgents for Amazon Bedrockとは\\u003c/a\\u003e\\n\\u003c/li\\u003e\\n\\u003cli\\u003e\\n\\u003ca href=\\\"#amazon-kendra%E3%81%A8%E3%81%AF\\\"\\u003eAmazon Kendraとは\\u003c/a\\u003e\\n\\u003c/li\\u003e\\n\\u003cli\\u003e\\n\\u003ca href=\\\"#bedrockkendra%E3%81%AB%E3%82%88%E3%82%8Brag%E3%81%A8knowledge-base%E3%81%AE%E9%81%95%E3%81%84\\\"\\u003eBedrock+KendraによるRAGと、Knowledge baseの違い\\u003c/a\\u003e\\n\\u003c/li\\u003e\\n\\u003cli\\u003e\\n\\u003ca href=\\\"#%E6%A4%9C%E8%A8%BC\\\"\\u003e検証\\u003c/a\\u003e\\n\\u003c/li\\u003e\\n\\u003cli\\u003e\\n\\u003ca href=\\\"#bedrock%E3%81%8C%E5%8F%82%E7%85%A7%E3%81%99%E3%82%8B%E3%82%B3%E3%83%B3%E3%83%86%E3%83%B3%E3%83%84%E3%81%AE%E7%94%A8%E6%84%8F\\\"\\u003eBedrockが参照するコンテンツの用意\\u003c/a\\u003e\\n\\u003c/li\\u003e\\n\\u003cli\\u003e\\n\\u003ca href=\\\"#%E3%82%A8%E3%83%BC%E3%82%B8%E3%82%A7%E3%83%B3%E3%83%88%E4%BD%9C%E6%88%90\\\"\\u003eエージェント作成\\u003c/a\\u003e\\n\\u003cul\\u003e\\n\\u003cli\\u003e\\n\\u003ca href=\\\"#step1%E3%82%A8%E3%83%BC%E3%82%B8%E3%82%A7%E3%83%B3%E3%83%88%E3%81%AE%E8%A9%B3%E7%B4%B0\\\"\\u003eStep1：エージェントの詳細\\u003c/a\\u003e\\n\\u003c/li\\u003e\\n\\u003cli\\u003e\\n\\u003ca href=\\\"#step2%E3%83%A2%E3%83%87%E3%83%AB%E9%81%B8%E6%8A%9E\\\"\\u003eStep2：モデル選択\\u003c/a\\u003e\\n\\u003c/li\\u003e\\n\\u003cli\\u003e\\n\\u003ca href=\\\"#step3%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E8%BF%BD%E5%8A%A0\\\"\\u003eStep3：アクショングループ追加\\u003c/a\\u003e\\n\\u003cul\\u003e\\n\\u003cli\\u003e\\n\\u003ca href=\\\"#lambda%E9%96%A2%E6%95%B0\\\"\\u003eLambda関数\\u003c/a\\u003e\\n\\u003c/li\\u003e\\n\\u003cli\\u003e\\n\\u003ca href=\\\"#openapi%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E\\\"\\u003eOpenAPIスキーマ\\u003c/a\\u003e\\n\\u003c/li\\u003e\\n\\u003c/ul\\u003e\\n\\u003c/li\\u003e\\n\\u003cli\\u003e\\n\\u003ca href=\\\"#step4%E3%83%8A%E3%83%AC%E3%83%83%E3%82%B8%E3%83%99%E3%83%BC%E3%82%B9%E3%82%92%E8%BF%BD%E5%8A%A0\\\"\\u003eStep4：ナレッジベースを追加\\u003c/a\\u003e\\n\\u003c/li\\u003e\\n\\u003c/ul\\u003e\\n\\u003c/li\\u003e\\n\\u003cli\\u003e\\n\\u003ca href=\\\"#%E3%83%86%E3%82%B9%E3%83%88\\\"\\u003eテスト\\u003c/a\\u003e\\n\\u003c/li\\u003e\\n\\u003cli\\u003e\\n\\u003ca href=\\\"#advanced-prompts%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E6%9C%AA%E6%A4%9C%E8%A8%BC\\\"\\u003eAdvanced Promptsについて(未検証)\\u003c/a\\u003e\\n\\u003c/li\\u003e\\n\\u003c/ul\\u003e\\n\",\"totalPv\":3236,\"uuid\":\"769f373f01261aec285a\",\"banReason\":null,\"adventCalendarItem\":{\"day\":16,\"calendar\":{\"name\":\"Japan AWS Jr. Champions\",\"urlName\":\"jr-champions\",\"year\":2023,\"organization\":null}},\"author\":{\"encryptedId\":\"BAhJIhFVc2VyLTI5ODg0MzQGOgZFVA==--d6af45c3643cd11047ab85982d08f7188e7626eb511b7ec076e29af52f0ce487\",\"isBlockingViewer\":false,\"isFollowableByViewer\":true,\"isFollowedByViewer\":false,\"isTweetWebNotificationReceivable\":true,\"profileImageUrlW48\":\"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fs3-ap-northeast-1.amazonaws.com%2Fqiita-image-store%2F0%2F2988434%2F7a415bfcdc60c99e01ba67e689b48ab72e4fb235%2Flarge.png%3F1696181594?ixlib=rb-4.0.0\\u0026auto=compress%2Cformat\\u0026lossless=0\\u0026w=48\\u0026s=fba329370d6c3d78c532234eb54cb807\",\"urlName\":\"Naoki_Ishihara\",\"twitterUrlName\":\"Ishihara_Naok1\",\"name\":\"石原 直樹\",\"organizations\":{\"edges\":[{\"node\":{\"urlName\":\"saison-technology\"}}]}},\"tags\":[{\"name\":\"AWS\",\"urlName\":\"aws\",\"itemsCount\":42529},{\"name\":\"rag\",\"urlName\":\"rag\",\"itemsCount\":309},{\"name\":\"bedrock\",\"urlName\":\"bedrock\",\"itemsCount\":416},{\"name\":\"Kendra\",\"urlName\":\"kendra\",\"itemsCount\":44},{\"name\":\"AgentsForAmazonBedrock\",\"urlName\":\"agentsforamazonbedrock\",\"itemsCount\":33}],\"followingLikers\":[],\"recentlyFollowingLikers\":[],\"postingCampaign\":null},\"comments\":[],\"client\":null,\"adsEventEmitter\":null}}",
    "metadata": {
      "url": "https://qiita.com/Naoki_Ishihara/items/769f373f01261aec285a",
      "title": "re:Invent 2023でGAされたAgents for Amazon BedrockとAmazon Kendraを組み合わせてRAGを構築 #AWS - Qiita"
    }
  }
]